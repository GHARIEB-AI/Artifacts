
============================================================
     LF WORKER - PORT 9225
============================================================
Worker: Worker_9225
Status: READY
Waiting for tasks...
============================================================


============================================================
[Worker_9225] Processing: JED-ATZ
  Tier 0: Range 2, Chunk 2/3
  Dates: 4 days
  Date Range: 2026-01-17 to 2026-01-14
============================================================

2025-12-29 07:54:35 | INFO     | ======================================================================
2025-12-29 07:54:35 | INFO     | Load Factor Scraper Started - Route: JED-ATZ
2025-12-29 07:54:35 | INFO     | Log file: D:\CODERED\LAB\market_insights\outputs\run_generated_291225_at_07.54\logs\LF_JED-ATZ_20251229_075435.log
2025-12-29 07:54:35 | INFO     | Enhanced logging: Capturing both logging.info() and print()
2025-12-29 07:54:35 | INFO     | ======================================================================
[LF] Processing dates (override): ['17JAN', '16JAN', '15JAN', '14JAN']
[LF] Attaching to Chrome for Altea access
[LF][[OK] SUCCESS] Connected to Chrome on 127.0.0.1:9225 (after 1 attempts)
[LF][[OK] SUCCESS] Found Amadeus Altea window: Altéa Reservation Desktop
[LF][[INFO] INFO] URL: https://tc212.resdesktop.altea.amadeus.com/app_ard/apf/init/login?SITE=ESMPESMP&LANGUAGE=GB&MARKETS=ARDW_PROD_WBP&ACTION=clpLogin
[LF] Processing JED-ATZ for 17JAN
[LF][ERROR] Amadeus command error detected: UNKNOWN TRANSACTION
[LF][ERROR] Command: SN17JANJEDATZ/ASM
[LF][RESYNC] Triggering immediate resync to last successful SN command
============================================================
[LF][RESYNC] Command 'SN17JANJEDATZ/ASM' failed: TECH_ERROR:UNKNOWN TRANSACTION
[LF][RESYNC] Re-running entire day from SN command for JED-ATZ 17JAN
[LF][RESYNC] Attempt 1/50 (waiting 1.0s before retry...)
============================================================
[LF][RESYNC] Sending IG to clear session state...
[LF][RESYNC] Session cleared with IG
[LF] Processing JED-ATZ for 17JAN
[LF] 17JAN: found 3 direct flights
[LF] SM492 17JAN: BKG=100, GRP=94, CAP=167, LF%=59.9%, Brd-Off=JED-ATZ, Classes: P:45, E:49, I:4, L:1, K:1
[LF] SM454 17JAN: BKG=54, GRP=45, CAP=167, LF%=32.3%, Brd-Off=JED-ATZ, Classes: P:45, I:4, U:4, G:1
[LF] SM456 17JAN: BKG=60, GRP=50, CAP=167, LF%=35.9%, Brd-Off=JED-ATZ, Classes: P:50, I:4, O:2, X:1, G:3
[LF] Getting WEEKLY/LASTSOLD data for 3 flights
[LF] SM492 17JAN: LASTSOLD=2025-12-22 00:00:00, WEEKLY=1, TODAY=0, YDAY=0
[LF] SM454 17JAN: LASTSOLD=2025-12-27 00:00:00, WEEKLY=1, TODAY=0, YDAY=0
[LF] SM456 17JAN: LASTSOLD=2025-12-28 00:00:00, WEEKLY=4, TODAY=0, YDAY=1
[LF] Processing JED-ATZ for 16JAN
[LF] 16JAN: found 1 direct flights
[LF] SM492 16JAN: BKG=56, GRP=45, CAP=167, LF%=33.5%, Brd-Off=JED-ATZ, Classes: P:45, I:4, O:2, U:3, L:2
[LF] Getting WEEKLY/LASTSOLD data for 1 flights
[LF] SM492 16JAN: LASTSOLD=2025-12-21 00:00:00, WEEKLY=0, TODAY=0, YDAY=0
[LF] Processing JED-ATZ for 15JAN
[LF] 15JAN: found 3 direct flights
[LF] SM422 15JAN: BKG=152, GRP=130, CAP=167, LF%=91.0%, Brd-Off=JED-ATZ, Classes: P:130, I:20, W:1, K:1
[LF] SM454 15JAN: BKG=149, GRP=135, CAP=167, LF%=89.2%, Brd-Off=JED-ATZ, Classes: P:135, I:4, O:2, U:3, S:2, V:2, K:1
[LF] SM456 15JAN: BKG=145, GRP=135, CAP=167, LF%=86.8%, Brd-Off=JED-ATZ, Classes: P:135, I:4, O:2, U:1, S:2, V:1
[LF] Getting WEEKLY/LASTSOLD data for 3 flights
[LF] SM422 15JAN: LASTSOLD=2025-12-28 00:00:00, WEEKLY=3, TODAY=0, YDAY=3
[LF] SM454 15JAN: LASTSOLD=2025-12-22 00:00:00, WEEKLY=1, TODAY=0, YDAY=0
[LF] SM456 15JAN: LASTSOLD=2025-12-28 00:00:00, WEEKLY=1, TODAY=0, YDAY=1
[LF] Processing JED-ATZ for 14JAN
[LF] 14JAN: found 2 direct flights
[LF] SM454 14JAN: BKG=179, GRP=172, CAP=167, LF%=107.2%, Brd-Off=JED-ATZ, Classes: P:136, E:36, I:4, O:2, U:1
[LF] SM492 14JAN: BKG=131, GRP=90, CAP=167, LF%=78.4%, Brd-Off=JED-ATZ, Classes: P:90, I:18, O:18, U:4, W:1
[LF] Getting WEEKLY/LASTSOLD data for 2 flights
[LF] SM454 14JAN: LASTSOLD=2025-12-28 00:00:00, WEEKLY=2, TODAY=0, YDAY=2
[LF] SM492 14JAN: LASTSOLD=2025-12-28 00:00:00, WEEKLY=36, TODAY=0, YDAY=2
[LF] Results summary:
  2026-01-17: 3 flights
  2026-01-16: 1 flights
  2026-01-15: 3 flights
  2026-01-14: 2 flights

============================================================
[Worker_9225] ✓ COMPLETED: JED-ATZ
  Results: 4 dates
  Errors: 0 dates
  Total Processed: 1 groups
============================================================


============================================================
[Worker_9225] Processing: CAI-RUH
  Tier 0: Range 1, Chunk 1/3
  Dates: 5 days
  Date Range: 2026-01-10 to 2026-01-06
============================================================

2025-12-29 07:55:36 | INFO     | ======================================================================
2025-12-29 07:55:36 | INFO     | Load Factor Scraper Started - Route: CAI-RUH
2025-12-29 07:55:36 | INFO     | Log file: D:\CODERED\LAB\market_insights\outputs\run_generated_291225_at_07.54\logs\LF_CAI-RUH_20251229_075536.log
2025-12-29 07:55:36 | INFO     | Enhanced logging: Capturing both logging.info() and print()
2025-12-29 07:55:36 | INFO     | ======================================================================
[LF] Processing dates (override): ['10JAN', '09JAN', '08JAN', '07JAN', '06JAN']
[LF] Attaching to Chrome for Altea access
2025-12-29 07:55:36 | INFO     | Starting LF search for route: CAI-RUH
2025-12-29 07:55:36 | INFO     | [START] LF Search
[LF][[OK] SUCCESS] Connected to Chrome on 127.0.0.1:9225 (after 1 attempts)
2025-12-29 07:55:37 | INFO     | [HEALTH CHECK] [OK] Chrome connection is healthy
[LF][[OK] SUCCESS] Found Amadeus Altea window: Altéa Reservation Desktop
[LF][[INFO] INFO] URL: https://tc212.resdesktop.altea.amadeus.com/app_ard/apf/init/login?SITE=ESMPESMP&LANGUAGE=GB&MARKETS=ARDW_PROD_WBP&ACTION=clpLogin
2025-12-29 07:55:37 | INFO     | [DAY_START] Processing 10JAN
[LF] Processing CAI-RUH for 10JAN
2025-12-29 07:55:37 | INFO     | [lf.day.start] Processing CAI-RUH for 10JAN
[LF] 10JAN: found 1 direct flights
2025-12-29 07:55:38 | INFO     | [lf.day.flights_found] Found 1 flights on 10JAN
2025-12-29 07:55:40 | INFO     | [lf.flight.extracted] SM461 on 10JAN: BKG=51, LF=28.5%
[LF] SM461 10JAN: BKG=51, GRP=0, CAP=179, LF%=28.5%, Brd-Off=CAI-RUH, Classes: I:5, O:9, U:19, X:18
[LF] Getting WEEKLY/LASTSOLD data for 1 flights
[LF] SM461 10JAN: LASTSOLD=2025-12-28 00:00:00, WEEKLY=23, TODAY=0, YDAY=1
2025-12-29 07:55:44 | INFO     | [SUCCESS] Day 10JAN
2025-12-29 07:55:44 | INFO     | [DAY_START] Processing 09JAN
[LF] Processing CAI-RUH for 09JAN
2025-12-29 07:55:44 | INFO     | [lf.day.start] Processing CAI-RUH for 09JAN
[LF] 09JAN: found 2 direct flights
2025-12-29 07:55:45 | INFO     | [lf.day.flights_found] Found 2 flights on 09JAN
2025-12-29 07:55:47 | INFO     | [lf.flight.extracted] SM461 on 09JAN: BKG=50, LF=27.9%
[LF] SM461 09JAN: BKG=50, GRP=0, CAP=179, LF%=27.9%, Brd-Off=CAI-RUH, Classes: I:15, O:15, U:15, X:5
2025-12-29 07:55:51 | INFO     | [lf.flight.extracted] SM469 on 09JAN: BKG=41, LF=22.9%
[LF] SM469 09JAN: BKG=41, GRP=0, CAP=179, LF%=22.9%, Brd-Off=CAI-RUH, Classes: I:4, O:10, U:19, X:7, S:1
[LF] Getting WEEKLY/LASTSOLD data for 2 flights
[LF] SM461 09JAN: LASTSOLD=2025-12-28 00:00:00, WEEKLY=12, TODAY=0, YDAY=2
[LF] SM469 09JAN: LASTSOLD=2025-12-28 00:00:00, WEEKLY=14, TODAY=0, YDAY=1
2025-12-29 07:55:59 | INFO     | [SUCCESS] Day 09JAN
2025-12-29 07:55:59 | INFO     | [DAY_START] Processing 08JAN
[LF] Processing CAI-RUH for 08JAN
2025-12-29 07:55:59 | INFO     | [lf.day.start] Processing CAI-RUH for 08JAN
[LF] 08JAN: found 1 direct flights
2025-12-29 07:56:00 | INFO     | [lf.day.flights_found] Found 1 flights on 08JAN
2025-12-29 07:56:02 | INFO     | [lf.flight.extracted] SM461 on 08JAN: BKG=77, LF=43.0%
[LF] SM461 08JAN: BKG=77, GRP=0, CAP=179, LF%=43.0%, Brd-Off=CAI-RUH, Classes: I:15, O:45, U:15, X:2
[LF] Getting WEEKLY/LASTSOLD data for 1 flights
[LF] SM461 08JAN: LASTSOLD=2025-12-28 00:00:00, WEEKLY=46, TODAY=0, YDAY=6
2025-12-29 07:56:06 | INFO     | [SUCCESS] Day 08JAN
2025-12-29 07:56:06 | INFO     | [DAY_START] Processing 07JAN
[LF] Processing CAI-RUH for 07JAN
2025-12-29 07:56:06 | INFO     | [lf.day.start] Processing CAI-RUH for 07JAN
[LF] 07JAN: found 2 direct flights
2025-12-29 07:56:07 | INFO     | [lf.day.flights_found] Found 2 flights on 07JAN
2025-12-29 07:56:09 | INFO     | [lf.flight.extracted] SM461 on 07JAN: BKG=77, LF=43.0%
[LF] SM461 07JAN: BKG=77, GRP=0, CAP=179, LF%=43.0%, Brd-Off=CAI-RUH, Classes: I:15, O:45, U:15, X:1, S:1
2025-12-29 07:56:13 | INFO     | [lf.flight.extracted] SM469 on 07JAN: BKG=52, LF=29.0%
[LF] SM469 07JAN: BKG=52, GRP=0, CAP=179, LF%=29.0%, Brd-Off=CAI-RUH, Classes: I:11, O:20, U:14, X:6, W:1
[LF] Getting WEEKLY/LASTSOLD data for 2 flights
[LF] SM461 07JAN: LASTSOLD=2025-12-28 00:00:00, WEEKLY=48, TODAY=0, YDAY=11
[LF] SM469 07JAN: LASTSOLD=2025-12-28 00:00:00, WEEKLY=20, TODAY=0, YDAY=5
2025-12-29 07:56:22 | INFO     | [SUCCESS] Day 07JAN
2025-12-29 07:56:22 | INFO     | [DAY_START] Processing 06JAN
[LF] Processing CAI-RUH for 06JAN
2025-12-29 07:56:22 | INFO     | [lf.day.start] Processing CAI-RUH for 06JAN
[LF] 06JAN: found 1 direct flights
2025-12-29 07:56:23 | INFO     | [lf.day.flights_found] Found 1 flights on 06JAN
2025-12-29 07:56:25 | INFO     | [lf.flight.extracted] SM469 on 06JAN: BKG=70, LF=39.1%
[LF] SM469 06JAN: BKG=70, GRP=0, CAP=179, LF%=39.1%, Brd-Off=CAI-RUH, Classes: I:5, O:30, U:15, X:14, T:6
[LF] Getting WEEKLY/LASTSOLD data for 1 flights
[LF] SM469 06JAN: LASTSOLD=2025-12-28 00:00:00, WEEKLY=27, TODAY=0, YDAY=9
2025-12-29 07:56:30 | INFO     | [SUCCESS] Day 06JAN
[LF] Results summary:
  2026-01-10: 1 flights
  2026-01-09: 2 flights
  2026-01-08: 1 flights
  2026-01-07: 2 flights
  2026-01-06: 1 flights
2025-12-29 07:56:30 | INFO     | [SUCCESS] LF Search Complete

============================================================
[Worker_9225] ✓ COMPLETED: CAI-RUH
  Results: 5 dates
  Errors: 0 dates
  Total Processed: 2 groups
============================================================

2025-12-29 07:56:32 | INFO     | [Worker_9225] Completed: CAI-RUH - 5 results, 0 errors

============================================================
[Worker_9225] Processing: JED-CAI
  Tier 0: Range 1, Chunk 3/3
  Dates: 4 days
  Date Range: 2025-12-31 to 2025-12-28
============================================================

2025-12-29 07:56:32 | INFO     | [Worker_9225] Processing: JED-CAI
2025-12-29 07:56:32 | INFO     |   Tier 0: Range 1, Chunk 3/3 (4 days)
2025-12-29 07:56:32 | INFO     | ======================================================================
2025-12-29 07:56:32 | INFO     | Load Factor Scraper Started - Route: JED-CAI
2025-12-29 07:56:32 | INFO     | Log file: D:\CODERED\LAB\market_insights\outputs\run_generated_291225_at_07.54\logs\LF_JED-CAI_20251229_075632.log
2025-12-29 07:56:32 | INFO     | Enhanced logging: Capturing both logging.info() and print()
2025-12-29 07:56:32 | INFO     | ======================================================================
[LF] Processing dates (override): ['31DEC', '30DEC', '29DEC', '28DEC']
[LF] Attaching to Chrome for Altea access
2025-12-29 07:56:32 | INFO     | Starting LF search for route: JED-CAI
2025-12-29 07:56:32 | INFO     | [START] LF Search
[LF][[OK] SUCCESS] Connected to Chrome on 127.0.0.1:9225 (after 1 attempts)
2025-12-29 07:56:33 | INFO     | [HEALTH CHECK] [OK] Chrome connection is healthy
[LF][[OK] SUCCESS] Found Amadeus Altea window: Altéa Reservation Desktop
[LF][[INFO] INFO] URL: https://tc212.resdesktop.altea.amadeus.com/app_ard/apf/init/login?SITE=ESMPESMP&LANGUAGE=GB&MARKETS=ARDW_PROD_WBP&ACTION=clpLogin
2025-12-29 07:56:33 | INFO     | [DAY_START] Processing 31DEC
[LF] Processing JED-CAI for 31DEC
2025-12-29 07:56:33 | INFO     | [lf.day.start] Processing JED-CAI for 31DEC
[LF] 31DEC: found 3 direct flights
2025-12-29 07:56:34 | INFO     | [lf.day.flights_found] Found 3 flights on 31DEC
2025-12-29 07:56:36 | INFO     | [lf.flight.extracted] SM476 on 31DEC: BKG=173, LF=97.2%
[LF] SM476 31DEC: BKG=173, GRP=130, CAP=178, LF%=97.2%, Brd-Off=JED-CAI, Classes: P:130, I:10, O:10, U:21, X:2
2025-12-29 07:56:40 | INFO     | [lf.flight.extracted] SM460 on 31DEC: BKG=166, LF=93.3%
[LF] SM460 31DEC: BKG=166, GRP=42, CAP=178, LF%=93.3%, Brd-Off=JED-CAI, Classes: P:42, I:10, O:20, U:40, X:40, T:3, W:3, S:8
[LPC] SM460 31DEC: Found 4 outbound flights with connecting passengers
2025-12-29 07:56:45 | INFO     | [lf.flight.extracted] SM478 on 31DEC: BKG=165, LF=92.7%
[LF] SM478 31DEC: BKG=165, GRP=101, CAP=178, LF%=92.7%, Brd-Off=JED-CAI, Classes: P:101, I:10, O:10, U:21, X:17, S:6
[LF] Getting WEEKLY/LASTSOLD data for 3 flights
Process Process-5:
Traceback (most recent call last):
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\process.py", line 313, in _bootstrap
    self.run()
    ~~~~~~~~^^
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\CODERED\LAB\market_insights\orchestration\queue_worker_system.py", line 580, in lf_worker_process
    results, errors = run_lf_search(
                      ~~~~~~~~~~~~~^
        origin=origin,
        ^^^^^^^^^^^^^^
    ...<3 lines>...
        progress_callback=heartbeat_callback
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "D:\CODERED\LAB\market_insights\lf\orchestration.py", line 771, in run_lf_search
    dtok, rows, err = process_lf_day(drv, origin, dest, dtok, year_for_token)
                      ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\CODERED\LAB\market_insights\lf\orchestration.py", line 287, in process_lf_day
    return handle_amadeus_error_with_resync(
        drv, origin, dest, dtok, year,
        _process_lf_day_once,
        resync_wait_sec=RESYNC_WAIT_SEC
    )
  File "D:\CODERED\LAB\market_insights\lf\amadeus.py", line 186, in handle_amadeus_error_with_resync
    result = process_func(drv, origin, dest, dtok, year)
  File "D:\CODERED\LAB\market_insights\lf\orchestration.py", line 483, in _process_lf_day_once
    last_sold, weekly_sold, sold_today, sold_yesterday = weekly_from_lpl_pages(drv, flight, dtok, year_)
                                                         ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\CODERED\LAB\market_insights\lf\parsers.py", line 868, in weekly_from_lpl_pages
    first = send_and_wait(drv, cmd, expect_tokens=[flight, dtok], timeout=SEND_TIMEOUT_SEC) or ""
            ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\CODERED\LAB\market_insights\lf\amadeus.py", line 370, in send_and_wait
    inp = focus_cmdline(drv)
  File "D:\CODERED\LAB\market_insights\lf\amadeus.py", line 271, in focus_cmdline
    time.sleep(0.1)
    ~~~~~~~~~~^^^^^
KeyboardInterrupt
Exception ignored in: <function Service.__del__ at 0x000001DCC6498F40>
Traceback (most recent call last):
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\site-packages\selenium\webdriver\common\service.py", line 185, in __del__
    self.stop()
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\site-packages\selenium\webdriver\common\service.py", line 146, in stop
    self.send_remote_shutdown_command()
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\site-packages\selenium\webdriver\common\service.py", line 126, in send_remote_shutdown_command
    request.urlopen(f"{self.service_url}/shutdown")
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\urllib\request.py", line 189, in urlopen
    return opener.open(url, data, timeout)
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\urllib\request.py", line 489, in open
    response = self._open(req, data)
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\urllib\request.py", line 506, in _open
    result = self._call_chain(self.handle_open, protocol, protocol +
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\urllib\request.py", line 466, in _call_chain
    result = func(*args)
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\urllib\request.py", line 1348, in http_open
    return self.do_open(http.client.HTTPConnection, req)
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\urllib\request.py", line 1319, in do_open
    h.request(req.get_method(), req.selector, req.data, headers,
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1338, in request
    self._send_request(method, url, body, headers, encode_chunked)
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1384, in _send_request
    self.endheaders(body, encode_chunked=encode_chunked)
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1003, in connect
    self.sock = self._create_connection(
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\socket.py", line 856, in create_connection
    exceptions.clear()  # raise only the last error
KeyboardInterrupt: 
Exception ignored in atexit callback <bound method BufferedTraceWriter.shutdown of <market_insights.observability.tracing.tracer.BufferedTraceWriter object at 0x000001DCC6557B60>>:
Traceback (most recent call last):
  File "D:\CODERED\LAB\market_insights\observability\tracing\tracer.py", line 322, in shutdown
    self._writer_thread.join(timeout=5.0)
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\threading.py", line 1094, in join
    self._handle.join(timeout)
KeyboardInterrupt: 
