
============================================================
     LF WORKER - PORT 9223
============================================================
Worker: Worker_9223
Status: READY
Waiting for tasks...
============================================================


============================================================
[Worker_9223] Processing: JED-ATZ
  Tier 0: Range 2, Chunk 1/3
  Dates: 4 days
  Date Range: 2026-01-21 to 2026-01-18
============================================================

2025-12-29 07:54:35 | INFO     | ======================================================================
2025-12-29 07:54:35 | INFO     | Load Factor Scraper Started - Route: JED-ATZ
2025-12-29 07:54:35 | INFO     | Log file: D:\CODERED\LAB\market_insights\outputs\run_generated_291225_at_07.54\logs\LF_JED-ATZ_20251229_075435.log
2025-12-29 07:54:35 | INFO     | Enhanced logging: Capturing both logging.info() and print()
2025-12-29 07:54:35 | INFO     | ======================================================================
[LF] Processing dates (override): ['21JAN', '20JAN', '19JAN', '18JAN']
[LF] Attaching to Chrome for Altea access
[LF][[OK] SUCCESS] Connected to Chrome on 127.0.0.1:9223 (after 1 attempts)
[LF][[OK] SUCCESS] Found Amadeus Altea window: Altéa Reservation Desktop
[LF][[INFO] INFO] URL: https://tc212.resdesktop.altea.amadeus.com/app_ard/apf/init/login?SITE=ESMPESMP&LANGUAGE=GB&MARKETS=ARDW_PROD_WBP&ACTION=clpLogin
[LF] Processing JED-ATZ for 21JAN
[LF][ERROR] Amadeus command error detected: UNKNOWN TRANSACTION
[LF][ERROR] Command: SN21JANJEDATZ/ASM
[LF][RESYNC] Triggering immediate resync to last successful SN command
============================================================
[LF][RESYNC] Command 'SN21JANJEDATZ/ASM' failed: TECH_ERROR:UNKNOWN TRANSACTION
[LF][RESYNC] Re-running entire day from SN command for JED-ATZ 21JAN
[LF][RESYNC] Attempt 1/50 (waiting 1.0s before retry...)
============================================================
[LF][RESYNC] Sending IG to clear session state...
[LF][RESYNC] Session cleared with IG
[LF] Processing JED-ATZ for 21JAN
[LF] 21JAN: found 2 direct flights
[LF] SM454 21JAN: BKG=181, GRP=180, CAP=167, LF%=108.4%, Brd-Off=JED-ATZ, Classes: P:135, E:45, I:1
[LF] SM492 21JAN: BKG=171, GRP=165, CAP=167, LF%=102.4%, Brd-Off=JED-ATZ, Classes: P:165, I:4, S:2
[LF] Getting WEEKLY/LASTSOLD data for 2 flights
[LF] SM454 21JAN: LASTSOLD=2025-12-03 00:00:00, WEEKLY=0, TODAY=0, YDAY=0
[LF] SM492 21JAN: LASTSOLD=2025-12-22 00:00:00, WEEKLY=1, TODAY=0, YDAY=0
[LF] Processing JED-ATZ for 20JAN
[LF] 20JAN: found 2 direct flights
[LF] SM454 20JAN: BKG=167, GRP=139, CAP=167, LF%=100.0%, Brd-Off=JED-ATZ, Classes: P:95, E:44, I:19, O:7, T:1, S:1
[LF] SM456 20JAN: BKG=164, GRP=135, CAP=167, LF%=98.2%, Brd-Off=JED-ATZ, Classes: P:135, I:22, O:4, U:3
[LF] Getting WEEKLY/LASTSOLD data for 2 flights
[LF] SM454 20JAN: LASTSOLD=2025-12-28 00:00:00, WEEKLY=8, TODAY=0, YDAY=3
[LF] SM456 20JAN: LASTSOLD=2025-12-28 00:00:00, WEEKLY=14, TODAY=0, YDAY=5
[LF] Processing JED-ATZ for 19JAN
[LF] 19JAN: found 4 direct flights
[LF] SM492 19JAN: BKG=67, GRP=48, CAP=167, LF%=40.1%, Brd-Off=JED-ATZ, Classes: P:48, I:16, O:2, S:1
[LF] SM456 19JAN: BKG=18, GRP=0, CAP=167, LF%=10.8%, Brd-Off=JED-ATZ, Classes: I:17, O:1
[LF] SM422 19JAN: BKG=26, GRP=0, CAP=167, LF%=15.6%, Brd-Off=JED-ATZ, Classes: I:22, O:3, K:1
[LF] SM454 19JAN: BKG=117, GRP=91, CAP=167, LF%=70.1%, Brd-Off=JED-ATZ, Classes: E:91, I:17, O:6, U:2, S:1
[LF] Getting WEEKLY/LASTSOLD data for 4 flights
[LF] SM492 19JAN: LASTSOLD=2025-12-27 00:00:00, WEEKLY=7, TODAY=0, YDAY=0
[LF] SM456 19JAN: LASTSOLD=2025-12-28 00:00:00, WEEKLY=12, TODAY=0, YDAY=1
[LF] SM422 19JAN: LASTSOLD=2025-12-28 00:00:00, WEEKLY=16, TODAY=0, YDAY=5
[LF] SM454 19JAN: LASTSOLD=2025-12-28 00:00:00, WEEKLY=10, TODAY=0, YDAY=1
[LF] Processing JED-ATZ for 18JAN
[LF] 18JAN: found 2 direct flights
[LF] SM492 18JAN: BKG=125, GRP=90, CAP=167, LF%=74.9%, Brd-Off=JED-ATZ, Classes: P:90, I:17, O:17, U:1
[LF] SM456 18JAN: BKG=78, GRP=45, CAP=167, LF%=46.7%, Brd-Off=JED-ATZ, Classes: P:45, I:17, O:15, S:1
[LF] Getting WEEKLY/LASTSOLD data for 2 flights
[LF] SM492 18JAN: LASTSOLD=2025-12-25 00:00:00, WEEKLY=13, TODAY=0, YDAY=0
[LF] SM456 18JAN: LASTSOLD=2025-12-28 00:00:00, WEEKLY=15, TODAY=0, YDAY=1
[LF] Results summary:
  2026-01-21: 2 flights
  2026-01-20: 2 flights
  2026-01-19: 4 flights
  2026-01-18: 2 flights

============================================================
[Worker_9223] ✓ COMPLETED: JED-ATZ
  Results: 4 dates
  Errors: 0 dates
  Total Processed: 1 groups
============================================================


============================================================
[Worker_9223] Processing: JED-CAI
  Tier 0: Range 1, Chunk 2/3
  Dates: 5 days
  Date Range: 2026-01-05 to 2026-01-01
============================================================

2025-12-29 07:55:41 | INFO     | ======================================================================
2025-12-29 07:55:41 | INFO     | Load Factor Scraper Started - Route: JED-CAI
2025-12-29 07:55:41 | INFO     | Log file: D:\CODERED\LAB\market_insights\outputs\run_generated_291225_at_07.54\logs\LF_JED-CAI_20251229_075541.log
2025-12-29 07:55:41 | INFO     | Enhanced logging: Capturing both logging.info() and print()
2025-12-29 07:55:41 | INFO     | ======================================================================
[LF] Processing dates (override): ['05JAN', '04JAN', '03JAN', '02JAN', '01JAN']
[LF] Attaching to Chrome for Altea access
2025-12-29 07:55:41 | INFO     | Starting LF search for route: JED-CAI
2025-12-29 07:55:41 | INFO     | [START] LF Search
[LF][[OK] SUCCESS] Connected to Chrome on 127.0.0.1:9223 (after 1 attempts)
2025-12-29 07:55:42 | INFO     | [HEALTH CHECK] [OK] Chrome connection is healthy
[LF][[OK] SUCCESS] Found Amadeus Altea window: Altéa Reservation Desktop
[LF][[INFO] INFO] URL: https://tc212.resdesktop.altea.amadeus.com/app_ard/apf/init/login?SITE=ESMPESMP&LANGUAGE=GB&MARKETS=ARDW_PROD_WBP&ACTION=clpLogin
2025-12-29 07:55:42 | INFO     | [DAY_START] Processing 05JAN
[LF] Processing JED-CAI for 05JAN
2025-12-29 07:55:42 | INFO     | [lf.day.start] Processing JED-CAI for 05JAN
[LF] 05JAN: found 4 direct flights
2025-12-29 07:55:43 | INFO     | [lf.day.flights_found] Found 4 flights on 05JAN
2025-12-29 07:55:45 | INFO     | [lf.flight.extracted] SM480 on 05JAN: BKG=81, LF=48.5%
[LF] SM480 05JAN: BKG=81, GRP=44, CAP=167, LF%=48.5%, Brd-Off=JED-CAI, Classes: P:44, U:24, X:10, S:3
2025-12-29 07:55:48 | INFO     | [lf.flight.extracted] SM476 on 05JAN: BKG=177, LF=98.9%
[LF] SM476 05JAN: BKG=177, GRP=142, CAP=179, LF%=98.9%, Brd-Off=JED-CAI, Classes: P:142, U:20, X:12, W:1, S:2
2025-12-29 07:55:52 | INFO     | [lf.flight.extracted] SM478 on 05JAN: BKG=168, LF=100.6%
[LF] SM478 05JAN: BKG=168, GRP=138, CAP=167, LF%=100.6%, Brd-Off=JED-CAI, Classes: P:138, U:16, X:12, W:1, K:1
2025-12-29 07:55:55 | INFO     | [lf.flight.extracted] SM460 on 05JAN: BKG=167, LF=100.0%
[LF] SM460 05JAN: BKG=167, GRP=132, CAP=167, LF%=100.0%, Brd-Off=JED-CAI, Classes: P:132, U:15, X:3, W:1, S:9, Q:2, H:5
[LPC] SM460 05JAN: Found 0 outbound flights with connecting passengers
[LF] Getting WEEKLY/LASTSOLD data for 4 flights
[LF] SM480 05JAN: LASTSOLD=2025-12-29 00:00:00, WEEKLY=22, TODAY=1, YDAY=9
[LF] SM476 05JAN: LASTSOLD=2025-12-26 00:00:00, WEEKLY=22, TODAY=0, YDAY=0
[LF] SM478 05JAN: LASTSOLD=2025-12-24 00:00:00, WEEKLY=8, TODAY=0, YDAY=0
[LF] SM460 05JAN: LASTSOLD=2025-12-25 00:00:00, WEEKLY=7, TODAY=0, YDAY=0
2025-12-29 07:56:16 | INFO     | [SUCCESS] Day 05JAN
2025-12-29 07:56:16 | INFO     | [DAY_START] Processing 04JAN
[LF] Processing JED-CAI for 04JAN
2025-12-29 07:56:16 | INFO     | [lf.day.start] Processing JED-CAI for 04JAN
[LF] 04JAN: found 5 direct flights
2025-12-29 07:56:17 | INFO     | [lf.day.flights_found] Found 5 flights on 04JAN
2025-12-29 07:56:19 | INFO     | [lf.flight.extracted] SM424 on 04JAN: BKG=168, LF=100.6%
[LF] SM424 04JAN: BKG=168, GRP=160, CAP=167, LF%=100.6%, Brd-Off=JED-CAI, Classes: N:5, E:155, X:5, T:3
[LPC] SM424 04JAN: Found 2 outbound flights with connecting passengers
2025-12-29 07:56:33 | INFO     | [lf.flight.extracted] SM476 on 04JAN: BKG=88, LF=52.7%
[LF] SM476 04JAN: BKG=88, GRP=27, CAP=167, LF%=52.7%, Brd-Off=JED-CAI, Classes: P:27, I:17, O:2, U:25, X:14, W:1, S:1, K:1
2025-12-29 07:56:36 | INFO     | [lf.flight.extracted] SM432 on 04JAN: BKG=118, LF=70.7%
[LF] SM432 04JAN: BKG=118, GRP=96, CAP=167, LF%=70.7%, Brd-Off=JED-CAI, Classes: P:96, U:10, X:11, K:1
2025-12-29 07:56:39 | INFO     | [lf.flight.extracted] SM460 on 04JAN: BKG=139, LF=83.2%
[LF] SM460 04JAN: BKG=139, GRP=97, CAP=167, LF%=83.2%, Brd-Off=JED-CAI, Classes: N:2, P:97, U:20, X:16, W:2, S:1, K:1
2025-12-29 07:56:43 | INFO     | [lf.flight.extracted] SM478 on 04JAN: BKG=145, LF=86.8%
[LF] SM478 04JAN: BKG=145, GRP=97, CAP=167, LF%=86.8%, Brd-Off=JED-CAI, Classes: P:97, I:1, U:19, X:25, W:2, S:1
[LF] Getting WEEKLY/LASTSOLD data for 5 flights
Process Process-3:
Traceback (most recent call last):
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1430, in getresponse
    response.begin()
    ~~~~~~~~~~~~~~^^
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 331, in begin
    version, status, reason = self._read_status()
                              ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 292, in _read_status
    line = str(self.fp.readline(_MAXLINE + 1), "iso-8859-1")
               ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\socket.py", line 719, in readinto
    return self._sock.recv_into(b)
           ~~~~~~~~~~~~~~~~~~~~^^^
ConnectionResetError: [WinError 10054] An existing connection was forcibly closed by the remote host

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\process.py", line 313, in _bootstrap
    self.run()
    ~~~~~~~~^^
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\CODERED\LAB\market_insights\orchestration\queue_worker_system.py", line 580, in lf_worker_process
    results, errors = run_lf_search(
                      ~~~~~~~~~~~~~^
        origin=origin,
        ^^^^^^^^^^^^^^
    ...<3 lines>...
        progress_callback=heartbeat_callback
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "D:\CODERED\LAB\market_insights\lf\orchestration.py", line 771, in run_lf_search
    dtok, rows, err = process_lf_day(drv, origin, dest, dtok, year_for_token)
                      ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\CODERED\LAB\market_insights\lf\orchestration.py", line 287, in process_lf_day
    return handle_amadeus_error_with_resync(
        drv, origin, dest, dtok, year,
        _process_lf_day_once,
        resync_wait_sec=RESYNC_WAIT_SEC
    )
  File "D:\CODERED\LAB\market_insights\lf\amadeus.py", line 186, in handle_amadeus_error_with_resync
    result = process_func(drv, origin, dest, dtok, year)
  File "D:\CODERED\LAB\market_insights\lf\orchestration.py", line 483, in _process_lf_day_once
    last_sold, weekly_sold, sold_today, sold_yesterday = weekly_from_lpl_pages(drv, flight, dtok, year_)
                                                         ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\CODERED\LAB\market_insights\lf\parsers.py", line 889, in weekly_from_lpl_pages
    more = send_and_wait(drv, "M", expect_tokens=[], timeout=SEND_TIMEOUT_SEC) or ""
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\CODERED\LAB\market_insights\lf\amadeus.py", line 381, in send_and_wait
    inp.clear()
    ~~~~~~~~~^^
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\site-packages\selenium\webdriver\remote\webelement.py", line 116, in clear
    self._execute(Command.CLEAR_ELEMENT)
    ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\site-packages\selenium\webdriver\remote\webelement.py", line 394, in _execute
    return self._parent.execute(command, params)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\site-packages\selenium\webdriver\remote\webdriver.py", line 345, in execute
    response = self.command_executor.execute(driver_command, params)
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\site-packages\selenium\webdriver\remote\remote_connection.py", line 300, in execute
    return self._request(command_info[0], url, body=data)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\site-packages\selenium\webdriver\remote\remote_connection.py", line 321, in _request
    response = self._conn.request(method, url, body=body, headers=headers)
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\_request_methods.py", line 143, in request
    return self.request_encode_body(
           ~~~~~~~~~~~~~~~~~~~~~~~~^
        method, url, fields=fields, headers=headers, **urlopen_kw
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\_request_methods.py", line 278, in request_encode_body
    return self.urlopen(method, url, **extra_kw)
           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\poolmanager.py", line 459, in urlopen
    response = conn.urlopen(method, u.request_uri, **kw)
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connectionpool.py", line 534, in _make_request
    response = conn.getresponse()
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 565, in getresponse
    httplib_response = super().getresponse()
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1432, in getresponse
    self.close()
    ~~~~~~~~~~^^
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\site-packages\urllib3\connection.py", line 369, in close
    def close(self) -> None:
    
KeyboardInterrupt

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "<string>", line 1, in <module>
    from multiprocessing.spawn import spawn_main; spawn_main(parent_pid=50600, pipe_handle=1436)
                                                  ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\process.py", line 327, in _bootstrap
    traceback.print_exc()
    ~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\traceback.py", line 208, in print_exc
    print_exception(sys.exception(), limit=limit, file=file, chain=chain)
    ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\traceback.py", line 129, in print_exception
    te = TracebackException(type(value), value, tb, limit=limit, compact=True)
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\traceback.py", line 1052, in __init__
    self.stack = StackSummary._extract_from_extended_frame_gen(
                 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        _walk_tb_with_full_positions(exc_traceback),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        limit=limit, lookup_lines=lookup_lines,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        capture_locals=capture_locals)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\traceback.py", line 500, in _extract_from_extended_frame_gen
    f.line
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\traceback.py", line 373, in line
    self._set_lines()
    ~~~~~~~~~~~~~~~^^
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\traceback.py", line 351, in _set_lines
    line = linecache.getline(self.filename, lineno).rstrip()
           ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\linecache.py", line 26, in getline
    lines = getlines(filename, module_globals)
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\linecache.py", line 42, in getlines
    return updatecache(filename, module_globals)
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\linecache.py", line 171, in updatecache
    with tokenize.open(fullname) as fp:
         ~~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\tokenize.py", line 455, in open
    buffer = _builtin_open(filename, 'rb')
KeyboardInterrupt
Exception ignored in atexit callback <bound method BufferedTraceWriter.shutdown of <market_insights.observability.tracing.tracer.BufferedTraceWriter object at 0x0000022CE46F7B60>>:
Traceback (most recent call last):
  File "D:\CODERED\LAB\market_insights\observability\tracing\tracer.py", line 322, in shutdown
    self._writer_thread.join(timeout=5.0)
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\threading.py", line 1094, in join
    self._handle.join(timeout)
KeyboardInterrupt: 
