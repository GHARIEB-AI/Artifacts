
============================================================
     LF WORKER - PORT 9222
============================================================
Worker: Worker_9222
Status: READY
Waiting for tasks...
============================================================


============================================================
[Worker_9222] Processing: JED-CAI
  Tier 0: Range 2, Chunk 1/3
  Dates: 4 days
  Date Range: 2026-01-21 to 2026-01-18
============================================================

2025-12-29 07:54:35 | INFO     | ======================================================================
2025-12-29 07:54:35 | INFO     | Load Factor Scraper Started - Route: JED-CAI
2025-12-29 07:54:35 | INFO     | Log file: D:\CODERED\LAB\market_insights\outputs\run_generated_291225_at_07.54\logs\LF_JED-CAI_20251229_075435.log
2025-12-29 07:54:35 | INFO     | Enhanced logging: Capturing both logging.info() and print()
2025-12-29 07:54:35 | INFO     | ======================================================================
[LF] Processing dates (override): ['21JAN', '20JAN', '19JAN', '18JAN']
[LF] Attaching to Chrome for Altea access
[LF][[OK] SUCCESS] Connected to Chrome on 127.0.0.1:9222 (after 1 attempts)
[LF][[OK] SUCCESS] Found Amadeus Altea window: Altéa Reservation Desktop
[LF][[INFO] INFO] URL: https://tc212.resdesktop.altea.amadeus.com/app_ard/apf/init/login?SITE=ESMPESMP&LANGUAGE=GB&MARKETS=ARDW_PROD_WBP&ACTION=clpLogin
[LF] Processing JED-CAI for 21JAN
[LF][ERROR] Amadeus command error detected: UNKNOWN TRANSACTION
[LF][ERROR] Command: SN21JANJEDCAI/ASM
[LF][RESYNC] Triggering immediate resync to last successful SN command
============================================================
[LF][RESYNC] Command 'SN21JANJEDCAI/ASM' failed: TECH_ERROR:UNKNOWN TRANSACTION
[LF][RESYNC] Re-running entire day from SN command for JED-CAI 21JAN
[LF][RESYNC] Attempt 1/50 (waiting 1.0s before retry...)
============================================================
[LF][RESYNC] Sending IG to clear session state...
[LF][RESYNC] Session cleared with IG
[LF] Processing JED-CAI for 21JAN
[LF] 21JAN: found 4 direct flights
[LF] SM476 21JAN: BKG=80, GRP=75, CAP=167, LF%=47.9%, Brd-Off=JED-CAI, Classes: P:75, I:1, U:4
[LF] SM478 21JAN: BKG=143, GRP=140, CAP=167, LF%=85.6%, Brd-Off=JED-CAI, Classes: P:140, O:3
[LF] SM460 21JAN: BKG=149, GRP=143, CAP=167, LF%=89.2%, Brd-Off=JED-CAI, Classes: P:98, E:45, I:1, O:3, U:2
[LF] SM424 21JAN: BKG=4, GRP=0, CAP=167, LF%=2.4%, Brd-Off=JED-CAI, Classes: I:3, U:1
[LF] Getting WEEKLY/LASTSOLD data for 4 flights
[LF] SM476 21JAN: LASTSOLD=2025-12-21 00:00:00, WEEKLY=0, TODAY=0, YDAY=0
[LF] SM478 21JAN: LASTSOLD=2025-12-26 00:00:00, WEEKLY=4, TODAY=0, YDAY=0
[LF] SM460 21JAN: LASTSOLD=2025-12-25 00:00:00, WEEKLY=4, TODAY=0, YDAY=0
[LF] SM424 21JAN: LASTSOLD=2025-12-25 00:00:00, WEEKLY=1, TODAY=0, YDAY=0
[LF] Processing JED-CAI for 20JAN
[LF] 20JAN: found 7 direct flights
[LF] SM472 20JAN: BKG=3, GRP=0, CAP=175, LF%=1.7%, Brd-Off=JED-CAI, Classes: I:1, U:2
[LF] SM954 20JAN: BKG=8, GRP=0, CAP=167, LF%=4.8%, Brd-Off=JED-CAI, Classes: I:8
[LF] SM480 20JAN: BKG=105, GRP=93, CAP=175, LF%=60.0%, Brd-Off=JED-CAI, Classes: P:93, I:3, O:1, U:8
[LF] SM478 20JAN: BKG=141, GRP=130, CAP=167, LF%=84.4%, Brd-Off=JED-CAI, Classes: P:130, I:2, O:1, U:7, L:1
[LF] SM460 20JAN: BKG=107, GRP=90, CAP=175, LF%=61.1%, Brd-Off=JED-CAI, Classes: N:3, P:90, I:3, O:1, U:10
[LF] SM424 20JAN: BKG=10, GRP=0, CAP=167, LF%=6.0%, Brd-Off=JED-CAI, Classes: I:7, U:3
[LF] SM476 20JAN: BKG=48, GRP=45, CAP=167, LF%=28.7%, Brd-Off=JED-CAI, Classes: P:45, U:3
[LF] Getting WEEKLY/LASTSOLD data for 7 flights
[LF] SM472 20JAN: LASTSOLD=2025-12-20 00:00:00, WEEKLY=0, TODAY=0, YDAY=0
[LF] SM954 20JAN: LASTSOLD=2025-12-28 00:00:00, WEEKLY=6, TODAY=0, YDAY=2
[LF] SM480 20JAN: LASTSOLD=2025-12-27 00:00:00, WEEKLY=5, TODAY=0, YDAY=0
[LF] SM478 20JAN: LASTSOLD=2025-12-28 00:00:00, WEEKLY=3, TODAY=0, YDAY=2
[LF][[SYNC] RETRYING] Cannot focus on command line
[LF][[INFO] INFO] Will try 50 times before pausing...
[LF] SM460 20JAN: LASTSOLD=2025-12-28 00:00:00, WEEKLY=7, TODAY=0, YDAY=1
[LF] SM424 20JAN: LASTSOLD=2025-12-28 00:00:00, WEEKLY=5, TODAY=0, YDAY=4
[LF] SM476 20JAN: LASTSOLD=2025-12-07 00:00:00, WEEKLY=0, TODAY=0, YDAY=0
[LF] Processing JED-CAI for 19JAN
[LF] 19JAN: found 4 direct flights
[LF] SM480 19JAN: BKG=1, GRP=0, CAP=167, LF%=0.6%, Brd-Off=JED-CAI, Classes: U:1
[LF] SM476 19JAN: BKG=152, GRP=139, CAP=167, LF%=91.0%, Brd-Off=JED-CAI, Classes: P:139, I:7, U:6
[LF] SM478 19JAN: BKG=64, GRP=51, CAP=167, LF%=38.3%, Brd-Off=JED-CAI, Classes: P:51, I:7, U:6
[LF] SM460 19JAN: BKG=141, GRP=140, CAP=167, LF%=84.4%, Brd-Off=JED-CAI, Classes: P:90, E:50, I:1
[LPC] SM460 19JAN: Found 0 outbound flights with connecting passengers
[LF] Getting WEEKLY/LASTSOLD data for 4 flights
[LF] SM480 19JAN: LASTSOLD=2025-10-22 00:00:00, WEEKLY=0, TODAY=0, YDAY=0
[LF] SM476 19JAN: LASTSOLD=2025-12-25 00:00:00, WEEKLY=7, TODAY=0, YDAY=0
[LF] SM478 19JAN: LASTSOLD=2025-12-28 00:00:00, WEEKLY=1, TODAY=0, YDAY=1
[LF] SM460 19JAN: LASTSOLD=2025-12-25 00:00:00, WEEKLY=4, TODAY=0, YDAY=0
[LF] Processing JED-CAI for 18JAN
[LF] 18JAN: found 5 direct flights
[LF] SM424 18JAN: BKG=99, GRP=90, CAP=167, LF%=59.3%, Brd-Off=JED-CAI, Classes: P:90, I:9
[LF] SM476 18JAN: BKG=2, GRP=0, CAP=168, LF%=1.2%, Brd-Off=JED-CAI, Classes: U:2
[LF] SM432 18JAN: BKG=44, GRP=40, CAP=167, LF%=26.4%, Brd-Off=JED-CAI, Classes: P:40, U:4
[LF] SM460 18JAN: BKG=52, GRP=49, CAP=167, LF%=31.1%, Brd-Off=JED-CAI, Classes: P:49, I:1, O:1, U:1
[LF] SM478 18JAN: BKG=156, GRP=135, CAP=167, LF%=93.4%, Brd-Off=JED-CAI, Classes: P:135, I:13, O:1, U:4, S:3
[LF] Getting WEEKLY/LASTSOLD data for 5 flights
[LF] SM424 18JAN: LASTSOLD=2025-12-28 00:00:00, WEEKLY=2, TODAY=0, YDAY=2
[LF] SM476 18JAN: LASTSOLD=2025-10-26 00:00:00, WEEKLY=0, TODAY=0, YDAY=0
[LF] SM432 18JAN: LASTSOLD=2025-12-28 00:00:00, WEEKLY=5, TODAY=0, YDAY=4
[LF] SM460 18JAN: LASTSOLD=2025-12-28 00:00:00, WEEKLY=2, TODAY=0, YDAY=1
[LF] SM478 18JAN: LASTSOLD=2025-12-28 00:00:00, WEEKLY=9, TODAY=0, YDAY=1
[LF] Results summary:
  2026-01-21: 4 flights
  2026-01-20: 7 flights
  2026-01-19: 4 flights
  2026-01-18: 5 flights

============================================================
[Worker_9222] ✓ COMPLETED: JED-CAI
  Results: 4 dates
  Errors: 0 dates
  Total Processed: 1 groups
============================================================


============================================================
[Worker_9222] Processing: ATZ-RUH
  Tier 0: Range 1, Chunk 2/3
  Dates: 5 days
  Date Range: 2026-01-05 to 2026-01-01
============================================================

2025-12-29 07:56:26 | INFO     | ======================================================================
2025-12-29 07:56:26 | INFO     | Load Factor Scraper Started - Route: ATZ-RUH
2025-12-29 07:56:26 | INFO     | Log file: D:\CODERED\LAB\market_insights\outputs\run_generated_291225_at_07.54\logs\LF_ATZ-RUH_20251229_075626.log
2025-12-29 07:56:26 | INFO     | Enhanced logging: Capturing both logging.info() and print()
2025-12-29 07:56:26 | INFO     | ======================================================================
[LF] Processing dates (override): ['05JAN', '04JAN', '03JAN', '02JAN', '01JAN']
[LF] Attaching to Chrome for Altea access
2025-12-29 07:56:26 | INFO     | Starting LF search for route: ATZ-RUH
2025-12-29 07:56:26 | INFO     | [START] LF Search
[LF][[OK] SUCCESS] Connected to Chrome on 127.0.0.1:9222 (after 1 attempts)
2025-12-29 07:56:27 | INFO     | [HEALTH CHECK] [OK] Chrome connection is healthy
[LF][[OK] SUCCESS] Found Amadeus Altea window: Altéa Reservation Desktop
[LF][[INFO] INFO] URL: https://tc212.resdesktop.altea.amadeus.com/app_ard/apf/init/login?SITE=ESMPESMP&LANGUAGE=GB&MARKETS=ARDW_PROD_WBP&ACTION=clpLogin
2025-12-29 07:56:27 | INFO     | [DAY_START] Processing 05JAN
[LF] Processing ATZ-RUH for 05JAN
2025-12-29 07:56:27 | INFO     | [lf.day.start] Processing ATZ-RUH for 05JAN
[LF] No direct flights on 05JAN for ATZ-RUH
2025-12-29 07:56:28 | WARNING  | [lf.day.no_flights] No direct flights on 05JAN
2025-12-29 07:56:29 | INFO     | [SUCCESS] Day 05JAN
2025-12-29 07:56:29 | INFO     | [DAY_START] Processing 04JAN
[LF] Processing ATZ-RUH for 04JAN
2025-12-29 07:56:29 | INFO     | [lf.day.start] Processing ATZ-RUH for 04JAN
[LF] 04JAN: found 1 direct flights
2025-12-29 07:56:30 | INFO     | [lf.day.flights_found] Found 1 flights on 04JAN
2025-12-29 07:56:32 | INFO     | [lf.flight.extracted] SM463 on 04JAN: BKG=127, LF=71.0%
[LF] SM463 04JAN: BKG=127, GRP=0, CAP=179, LF%=71.0%, Brd-Off=ATZ-RUH, Classes: O:6, U:7, X:17, T:20, W:10, S:10, G:19, L:37, K:1
[LF] Getting WEEKLY/LASTSOLD data for 1 flights
[LF] SM463 04JAN: LASTSOLD=2025-12-28 00:00:00, WEEKLY=31, TODAY=0, YDAY=8
2025-12-29 07:56:38 | INFO     | [SUCCESS] Day 04JAN
2025-12-29 07:56:38 | INFO     | [DAY_START] Processing 03JAN
[LF] Processing ATZ-RUH for 03JAN
2025-12-29 07:56:38 | INFO     | [lf.day.start] Processing ATZ-RUH for 03JAN
[LF] No direct flights on 03JAN for ATZ-RUH
2025-12-29 07:56:39 | WARNING  | [lf.day.no_flights] No direct flights on 03JAN
2025-12-29 07:56:39 | INFO     | [SUCCESS] Day 03JAN
2025-12-29 07:56:39 | INFO     | [DAY_START] Processing 02JAN
[LF] Processing ATZ-RUH for 02JAN
2025-12-29 07:56:39 | INFO     | [lf.day.start] Processing ATZ-RUH for 02JAN
[LF] No direct flights on 02JAN for ATZ-RUH
2025-12-29 07:56:40 | WARNING  | [lf.day.no_flights] No direct flights on 02JAN
2025-12-29 07:56:40 | INFO     | [SUCCESS] Day 02JAN
2025-12-29 07:56:40 | INFO     | [DAY_START] Processing 01JAN
[LF] Processing ATZ-RUH for 01JAN
2025-12-29 07:56:40 | INFO     | [lf.day.start] Processing ATZ-RUH for 01JAN
[LF] No direct flights on 01JAN for ATZ-RUH
2025-12-29 07:56:41 | WARNING  | [lf.day.no_flights] No direct flights on 01JAN
2025-12-29 07:56:41 | INFO     | [SUCCESS] Day 01JAN
[LF] Results summary:
  2026-01-05: 0 flights
  2026-01-04: 1 flights
  2026-01-03: 0 flights
  2026-01-02: 0 flights
  2026-01-01: 0 flights
2025-12-29 07:56:41 | INFO     | [SUCCESS] LF Search Complete

============================================================
[Worker_9222] ✓ COMPLETED: ATZ-RUH
  Results: 5 dates
  Errors: 0 dates
  Total Processed: 2 groups
============================================================

2025-12-29 07:56:43 | INFO     | [Worker_9222] Completed: ATZ-RUH - 5 results, 0 errors

============================================================
[Worker_9222] Processing: CAI-RUH
  Tier 0: Range 1, Chunk 3/3
  Dates: 4 days
  Date Range: 2025-12-31 to 2025-12-28
============================================================

2025-12-29 07:56:43 | INFO     | [Worker_9222] Processing: CAI-RUH
2025-12-29 07:56:43 | INFO     |   Tier 0: Range 1, Chunk 3/3 (4 days)
2025-12-29 07:56:43 | INFO     | ======================================================================
2025-12-29 07:56:43 | INFO     | Load Factor Scraper Started - Route: CAI-RUH
2025-12-29 07:56:43 | INFO     | Log file: D:\CODERED\LAB\market_insights\outputs\run_generated_291225_at_07.54\logs\LF_CAI-RUH_20251229_075643.log
2025-12-29 07:56:43 | INFO     | Enhanced logging: Capturing both logging.info() and print()
2025-12-29 07:56:43 | INFO     | ======================================================================
[LF] Processing dates (override): ['31DEC', '30DEC', '29DEC', '28DEC']
[LF] Attaching to Chrome for Altea access
2025-12-29 07:56:43 | INFO     | Starting LF search for route: CAI-RUH
2025-12-29 07:56:43 | INFO     | [START] LF Search
[LF][[OK] SUCCESS] Connected to Chrome on 127.0.0.1:9222 (after 1 attempts)
2025-12-29 07:56:44 | INFO     | [HEALTH CHECK] [OK] Chrome connection is healthy
[LF][[OK] SUCCESS] Found Amadeus Altea window: Altéa Reservation Desktop
[LF][[INFO] INFO] URL: https://tc212.resdesktop.altea.amadeus.com/app_ard/apf/init/login?SITE=ESMPESMP&LANGUAGE=GB&MARKETS=ARDW_PROD_WBP&ACTION=clpLogin
2025-12-29 07:56:44 | INFO     | [DAY_START] Processing 31DEC
[LF] Processing CAI-RUH for 31DEC
2025-12-29 07:56:44 | INFO     | [lf.day.start] Processing CAI-RUH for 31DEC
[LF] 31DEC: found 2 direct flights
2025-12-29 07:56:45 | INFO     | [lf.day.flights_found] Found 2 flights on 31DEC
Process Process-2:
Traceback (most recent call last):
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\process.py", line 313, in _bootstrap
    self.run()
    ~~~~~~~~^^
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\CODERED\LAB\market_insights\orchestration\queue_worker_system.py", line 580, in lf_worker_process
    results, errors = run_lf_search(
                      ~~~~~~~~~~~~~^
        origin=origin,
        ^^^^^^^^^^^^^^
    ...<3 lines>...
        progress_callback=heartbeat_callback
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "D:\CODERED\LAB\market_insights\lf\orchestration.py", line 771, in run_lf_search
    dtok, rows, err = process_lf_day(drv, origin, dest, dtok, year_for_token)
                      ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\CODERED\LAB\market_insights\lf\orchestration.py", line 287, in process_lf_day
    return handle_amadeus_error_with_resync(
        drv, origin, dest, dtok, year,
        _process_lf_day_once,
        resync_wait_sec=RESYNC_WAIT_SEC
    )
  File "D:\CODERED\LAB\market_insights\lf\amadeus.py", line 186, in handle_amadeus_error_with_resync
    result = process_func(drv, origin, dest, dtok, year)
  File "D:\CODERED\LAB\market_insights\lf\orchestration.py", line 360, in _process_lf_day_once
    ll_data, ll_txt = parse_ll_i_with_classes(drv, flight, dtok)
                      ~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "D:\CODERED\LAB\market_insights\lf\parsers.py", line 519, in parse_ll_i_with_classes
    page2_txt = send_and_wait(drv, "M", ["TOT   GRP   WL", "END OF DISPLAY"], timeout=5) or ""
                ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\CODERED\LAB\market_insights\lf\amadeus.py", line 423, in send_and_wait
    time.sleep(POLL_SLEEP_SEC)
    ~~~~~~~~~~^^^^^^^^^^^^^^^^
KeyboardInterrupt
Exception ignored in: <function Service.__del__ at 0x000002626AF98F40>
Traceback (most recent call last):
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\site-packages\selenium\webdriver\common\service.py", line 185, in __del__
    self.stop()
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\site-packages\selenium\webdriver\common\service.py", line 146, in stop
    self.send_remote_shutdown_command()
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\site-packages\selenium\webdriver\common\service.py", line 126, in send_remote_shutdown_command
    request.urlopen(f"{self.service_url}/shutdown")
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\urllib\request.py", line 189, in urlopen
    return opener.open(url, data, timeout)
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\urllib\request.py", line 489, in open
    response = self._open(req, data)
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\urllib\request.py", line 506, in _open
    result = self._call_chain(self.handle_open, protocol, protocol +
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\urllib\request.py", line 466, in _call_chain
    result = func(*args)
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\urllib\request.py", line 1348, in http_open
    return self.do_open(http.client.HTTPConnection, req)
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\urllib\request.py", line 1319, in do_open
    h.request(req.get_method(), req.selector, req.data, headers,
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1338, in request
    self._send_request(method, url, body, headers, encode_chunked)
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1384, in _send_request
    self.endheaders(body, encode_chunked=encode_chunked)
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1003, in connect
    self.sock = self._create_connection(
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\socket.py", line 856, in create_connection
    exceptions.clear()  # raise only the last error
KeyboardInterrupt: 
Exception ignored in atexit callback <bound method BufferedTraceWriter.shutdown of <market_insights.observability.tracing.tracer.BufferedTraceWriter object at 0x000002626B057B60>>:
Traceback (most recent call last):
  File "D:\CODERED\LAB\market_insights\observability\tracing\tracer.py", line 322, in shutdown
    self._writer_thread.join(timeout=5.0)
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\threading.py", line 1094, in join
    self._handle.join(timeout)
KeyboardInterrupt: 
