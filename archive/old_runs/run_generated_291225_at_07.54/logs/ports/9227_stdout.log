
============================================================
     LF WORKER - PORT 9227
============================================================
Worker: Worker_9227
Status: READY
Waiting for tasks...
============================================================


============================================================
[Worker_9227] Processing: CAI-RUH
  Tier 0: Range 2, Chunk 2/3
  Dates: 4 days
  Date Range: 2026-01-17 to 2026-01-14
============================================================

2025-12-29 07:54:35 | INFO     | ======================================================================
2025-12-29 07:54:35 | INFO     | Load Factor Scraper Started - Route: CAI-RUH
2025-12-29 07:54:35 | INFO     | Log file: D:\CODERED\LAB\market_insights\outputs\run_generated_291225_at_07.54\logs\LF_CAI-RUH_20251229_075435.log
2025-12-29 07:54:35 | INFO     | Enhanced logging: Capturing both logging.info() and print()
2025-12-29 07:54:35 | INFO     | ======================================================================
[LF] Processing dates (override): ['17JAN', '16JAN', '15JAN', '14JAN']
[LF] Attaching to Chrome for Altea access
[LF][[OK] SUCCESS] Connected to Chrome on 127.0.0.1:9227 (after 1 attempts)
[LF][[OK] SUCCESS] Found Amadeus Altea window: Altéa Reservation Desktop
[LF][[INFO] INFO] URL: https://tc212.resdesktop.altea.amadeus.com/app_ard/apf/init/login?SITE=ESMPESMP&LANGUAGE=GB&MARKETS=ARDW_PROD_WBP&ACTION=clpLogin
[LF] Processing CAI-RUH for 17JAN
[LF][ERROR] Amadeus command error detected: UNKNOWN TRANSACTION
[LF][ERROR] Command: SN17JANCAIRUH/ASM
[LF][RESYNC] Triggering immediate resync to last successful SN command
============================================================
[LF][RESYNC] Command 'SN17JANCAIRUH/ASM' failed: TECH_ERROR:UNKNOWN TRANSACTION
[LF][RESYNC] Re-running entire day from SN command for CAI-RUH 17JAN
[LF][RESYNC] Attempt 1/50 (waiting 1.0s before retry...)
============================================================
[LF][RESYNC] Sending IG to clear session state...
[LF][RESYNC] Session cleared with IG
[LF] Processing CAI-RUH for 17JAN
[LF] 17JAN: found 1 direct flights
[LF] SM461 17JAN: BKG=50, GRP=0, CAP=179, LF%=27.9%, Brd-Off=CAI-RUH, Classes: N:1, X:1, W:3, S:5, G:9, L:15, V:10, K:5, Q:1
[LF] Getting WEEKLY/LASTSOLD data for 1 flights
[LF] SM461 17JAN: LASTSOLD=2025-12-24 00:00:00, WEEKLY=2, TODAY=0, YDAY=0
[LF] Processing CAI-RUH for 16JAN
[LF] 16JAN: found 2 direct flights
[LF] SM461 16JAN: BKG=43, GRP=0, CAP=179, LF%=24.0%, Brd-Off=CAI-RUH, Classes: W:1, G:32, L:9, V:1
[LF] SM469 16JAN: BKG=26, GRP=0, CAP=179, LF%=14.5%, Brd-Off=CAI-RUH, Classes: W:5, S:2, G:11, L:4, K:4
[LF] Getting WEEKLY/LASTSOLD data for 2 flights
[LF] SM461 16JAN: LASTSOLD=2025-12-29 00:00:00, WEEKLY=19, TODAY=3, YDAY=5
[LF] SM469 16JAN: LASTSOLD=2025-12-28 00:00:00, WEEKLY=5, TODAY=0, YDAY=4
[LF] Processing CAI-RUH for 15JAN
[LF] 15JAN: found 1 direct flights
[LF] SM461 15JAN: BKG=35, GRP=0, CAP=179, LF%=19.6%, Brd-Off=CAI-RUH, Classes: X:1, W:14, S:10, G:10
[LF] Getting WEEKLY/LASTSOLD data for 1 flights
[LF] SM461 15JAN: LASTSOLD=2025-12-28 00:00:00, WEEKLY=23, TODAY=0, YDAY=4
[LF] Processing CAI-RUH for 14JAN
[LF] 14JAN: 1 cancelled flight(s) detected from SN
[LF] 14JAN: found 1 direct flights
[LF] SM469 14JAN: BKG=74, GRP=0, CAP=179, LF%=41.3%, Brd-Off=CAI-RUH, Classes: I:11, O:19, U:29, X:13, S:2
[LF] Getting WEEKLY/LASTSOLD data for 1 flights
[LF] SM469 14JAN: LASTSOLD=2025-12-27 00:00:00, WEEKLY=43, TODAY=0, YDAY=0
[LF] Results summary:
  2026-01-17: 1 flights
  2026-01-16: 2 flights
  2026-01-15: 1 flights
  2026-01-14: 1 flights
[LF] Cancelled flights found: 1
  - SM461 14JAN (SN)
[Worker_9227] Cancelled flights collected: 1

============================================================
[Worker_9227] ✓ COMPLETED: CAI-RUH
  Results: 4 dates
  Errors: 0 dates
  Total Processed: 1 groups
============================================================


============================================================
[Worker_9227] Processing: JED-CAI
  Tier 0: Range 1, Chunk 1/3
  Dates: 5 days
  Date Range: 2026-01-10 to 2026-01-06
============================================================

2025-12-29 07:55:16 | INFO     | ======================================================================
2025-12-29 07:55:16 | INFO     | Load Factor Scraper Started - Route: JED-CAI
2025-12-29 07:55:16 | INFO     | Log file: D:\CODERED\LAB\market_insights\outputs\run_generated_291225_at_07.54\logs\LF_JED-CAI_20251229_075516.log
2025-12-29 07:55:16 | INFO     | Enhanced logging: Capturing both logging.info() and print()
2025-12-29 07:55:16 | INFO     | ======================================================================
[LF] Processing dates (override): ['10JAN', '09JAN', '08JAN', '07JAN', '06JAN']
[LF] Attaching to Chrome for Altea access
2025-12-29 07:55:16 | INFO     | Starting LF search for route: JED-CAI
2025-12-29 07:55:16 | INFO     | [START] LF Search
[LF][[OK] SUCCESS] Connected to Chrome on 127.0.0.1:9227 (after 1 attempts)
2025-12-29 07:55:17 | INFO     | [HEALTH CHECK] [OK] Chrome connection is healthy
[LF][[OK] SUCCESS] Found Amadeus Altea window: Altéa Reservation Desktop
[LF][[INFO] INFO] URL: https://tc212.resdesktop.altea.amadeus.com/app_ard/apf/init/login?SITE=ESMPESMP&LANGUAGE=GB&MARKETS=ARDW_PROD_WBP&ACTION=clpLogin
2025-12-29 07:55:17 | INFO     | [DAY_START] Processing 10JAN
[LF] Processing JED-CAI for 10JAN
2025-12-29 07:55:17 | INFO     | [lf.day.start] Processing JED-CAI for 10JAN
[LF] 10JAN: found 3 direct flights
2025-12-29 07:55:19 | INFO     | [lf.day.flights_found] Found 3 flights on 10JAN
2025-12-29 07:55:21 | INFO     | [lf.flight.extracted] SM450 on 10JAN: BKG=156, LF=93.4%
[LF] SM450 10JAN: BKG=156, GRP=79, CAP=167, LF%=93.4%, Brd-Off=JED-CAI, Classes: P:79, U:10, X:12, T:5, W:8, S:4, G:7, L:6, V:22, K:3
[LPC] SM450 10JAN: Found 1 outbound flights with connecting passengers
2025-12-29 07:55:29 | INFO     | [lf.flight.extracted] SM476 on 10JAN: BKG=146, LF=87.4%
[LF] SM476 10JAN: BKG=146, GRP=87, CAP=167, LF%=87.4%, Brd-Off=JED-CAI, Classes: P:87, U:10, X:12, T:12, W:1, G:13, L:10, V:1
[LPC] SM476 10JAN: Found 0 outbound flights with connecting passengers
2025-12-29 07:55:33 | INFO     | [lf.flight.extracted] SM478 on 10JAN: BKG=168, LF=96.0%
[LF] SM478 10JAN: BKG=168, GRP=123, CAP=175, LF%=96.0%, Brd-Off=JED-CAI, Classes: P:123, U:10, X:12, T:18, W:2, K:3
[LF] Getting WEEKLY/LASTSOLD data for 3 flights
[LF][[SYNC] RETRYING] Cannot focus on command line
[LF][[INFO] INFO] Will try 50 times before pausing...
[LF] SM450 10JAN: LASTSOLD=2025-12-28 00:00:00, WEEKLY=13, TODAY=0, YDAY=3
[LF] SM476 10JAN: LASTSOLD=2025-12-28 00:00:00, WEEKLY=19, TODAY=0, YDAY=1
[LF] SM478 10JAN: LASTSOLD=2025-12-28 00:00:00, WEEKLY=16, TODAY=0, YDAY=13
2025-12-29 07:55:50 | INFO     | [SUCCESS] Day 10JAN
2025-12-29 07:55:50 | INFO     | [DAY_START] Processing 09JAN
[LF] Processing JED-CAI for 09JAN
2025-12-29 07:55:50 | INFO     | [lf.day.start] Processing JED-CAI for 09JAN
[LF] 09JAN: found 6 direct flights
2025-12-29 07:55:51 | INFO     | [lf.day.flights_found] Found 6 flights on 09JAN
2025-12-29 07:55:53 | INFO     | [lf.flight.extracted] SM424 on 09JAN: BKG=96, LF=54.9%
[LF] SM424 09JAN: BKG=96, GRP=1, CAP=175, LF%=54.9%, Brd-Off=JED-CAI, Classes: P:1, U:10, X:12, T:7, W:11, S:8, G:5, L:27, V:15
[LPC] SM424 09JAN: Found 1 outbound flights with connecting passengers
2025-12-29 07:55:59 | INFO     | [lf.flight.extracted] SM476 on 09JAN: BKG=162, LF=97.0%
[LF] SM476 09JAN: BKG=162, GRP=58, CAP=167, LF%=97.0%, Brd-Off=JED-CAI, Classes: P:58, U:10, X:12, T:10, W:8, S:29, G:14, L:15, V:6
[LPC] SM476 09JAN: Found 1 outbound flights with connecting passengers
2025-12-29 07:56:04 | INFO     | [lf.flight.extracted] SM478 on 09JAN: BKG=125, LF=74.9%
[LF] SM478 09JAN: BKG=125, GRP=0, CAP=167, LF%=74.9%, Brd-Off=JED-CAI, Classes: U:10, X:12, T:12, W:12, S:11, G:11, L:27, V:13, K:16, Q:1
[LPC] SM478 09JAN: Found 2 outbound flights with connecting passengers
2025-12-29 07:56:09 | INFO     | [lf.flight.extracted] SM480 on 09JAN: BKG=145, LF=86.8%
[LF] SM480 09JAN: BKG=145, GRP=45, CAP=167, LF%=86.8%, Brd-Off=JED-CAI, Classes: P:45, U:10, X:12, T:12, W:10, S:14, G:21, L:10, V:9, K:2
2025-12-29 07:56:12 | INFO     | [lf.flight.extracted] SM472 on 09JAN: BKG=128, LF=76.6%
[LF] SM472 09JAN: BKG=128, GRP=54, CAP=167, LF%=76.6%, Brd-Off=JED-CAI, Classes: P:54, U:10, X:12, T:12, W:12, S:11, G:7, V:7, K:3
[LPC] SM472 09JAN: Found 0 outbound flights with connecting passengers
2025-12-29 07:56:17 | INFO     | [lf.flight.extracted] SM460 on 09JAN: BKG=165, LF=94.3%
[LF] SM460 09JAN: BKG=165, GRP=135, CAP=175, LF%=94.3%, Brd-Off=JED-CAI, Classes: P:135, U:10, X:12, T:8
[LF] Getting WEEKLY/LASTSOLD data for 6 flights
[LF] SM424 09JAN: LASTSOLD=2025-12-28 00:00:00, WEEKLY=24, TODAY=0, YDAY=1
[LF] SM476 09JAN: LASTSOLD=2025-12-27 00:00:00, WEEKLY=26, TODAY=0, YDAY=0
[LF] SM478 09JAN: LASTSOLD=2025-12-28 00:00:00, WEEKLY=38, TODAY=0, YDAY=1
[LF] SM480 09JAN: LASTSOLD=2025-12-27 00:00:00, WEEKLY=19, TODAY=0, YDAY=0
[LF] SM472 09JAN: LASTSOLD=2025-12-28 00:00:00, WEEKLY=12, TODAY=0, YDAY=7
[LF] SM460 09JAN: LASTSOLD=2025-12-15 00:00:00, WEEKLY=0, TODAY=0, YDAY=0
2025-12-29 07:56:47 | INFO     | [SUCCESS] Day 09JAN
2025-12-29 07:56:47 | INFO     | [DAY_START] Processing 08JAN
[LF] Processing JED-CAI for 08JAN
2025-12-29 07:56:47 | INFO     | [lf.day.start] Processing JED-CAI for 08JAN
Process Process-7:
Traceback (most recent call last):
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\process.py", line 313, in _bootstrap
    self.run()
    ~~~~~~~~^^
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\CODERED\LAB\market_insights\orchestration\queue_worker_system.py", line 580, in lf_worker_process
    results, errors = run_lf_search(
                      ~~~~~~~~~~~~~^
        origin=origin,
        ^^^^^^^^^^^^^^
    ...<3 lines>...
        progress_callback=heartbeat_callback
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "D:\CODERED\LAB\market_insights\lf\orchestration.py", line 771, in run_lf_search
    dtok, rows, err = process_lf_day(drv, origin, dest, dtok, year_for_token)
                      ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\CODERED\LAB\market_insights\lf\orchestration.py", line 287, in process_lf_day
    return handle_amadeus_error_with_resync(
        drv, origin, dest, dtok, year,
        _process_lf_day_once,
        resync_wait_sec=RESYNC_WAIT_SEC
    )
  File "D:\CODERED\LAB\market_insights\lf\amadeus.py", line 186, in handle_amadeus_error_with_resync
    result = process_func(drv, origin, dest, dtok, year)
  File "D:\CODERED\LAB\market_insights\lf\orchestration.py", line 317, in _process_lf_day_once
    sn_txt = send_and_wait(drv, sn_cmd, expect_tokens=[dtok, origin, dest], timeout=SEND_TIMEOUT_SEC)
  File "D:\CODERED\LAB\market_insights\lf\amadeus.py", line 370, in send_and_wait
    inp = focus_cmdline(drv)
  File "D:\CODERED\LAB\market_insights\lf\amadeus.py", line 259, in focus_cmdline
    time.sleep(0.15)
    ~~~~~~~~~~^^^^^^
KeyboardInterrupt
Exception ignored in: <function Service.__del__ at 0x000001C7793F8F40>
Traceback (most recent call last):
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\site-packages\selenium\webdriver\common\service.py", line 185, in __del__
    self.stop()
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\site-packages\selenium\webdriver\common\service.py", line 146, in stop
    self.send_remote_shutdown_command()
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\site-packages\selenium\webdriver\common\service.py", line 126, in send_remote_shutdown_command
    request.urlopen(f"{self.service_url}/shutdown")
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\urllib\request.py", line 189, in urlopen
    return opener.open(url, data, timeout)
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\urllib\request.py", line 489, in open
    response = self._open(req, data)
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\urllib\request.py", line 506, in _open
    result = self._call_chain(self.handle_open, protocol, protocol +
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\urllib\request.py", line 466, in _call_chain
    result = func(*args)
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\urllib\request.py", line 1348, in http_open
    return self.do_open(http.client.HTTPConnection, req)
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\urllib\request.py", line 1319, in do_open
    h.request(req.get_method(), req.selector, req.data, headers,
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1338, in request
    self._send_request(method, url, body, headers, encode_chunked)
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1384, in _send_request
    self.endheaders(body, encode_chunked=encode_chunked)
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1003, in connect
    self.sock = self._create_connection(
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\socket.py", line 856, in create_connection
    exceptions.clear()  # raise only the last error
KeyboardInterrupt: 
Exception ignored in atexit callback <bound method BufferedTraceWriter.shutdown of <market_insights.observability.tracing.tracer.BufferedTraceWriter object at 0x000001C7794B7B60>>:
Traceback (most recent call last):
  File "D:\CODERED\LAB\market_insights\observability\tracing\tracer.py", line 322, in shutdown
    self._writer_thread.join(timeout=5.0)
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\threading.py", line 1094, in join
    self._handle.join(timeout)
KeyboardInterrupt: 
