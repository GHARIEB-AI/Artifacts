
============================================================
     LF WORKER - PORT 9233
============================================================
Worker: Worker_9233
Status: READY
Waiting for tasks...
============================================================


============================================================
[Worker_9233] Processing: ATZ-RUH
  Tier 0: Range 2, Chunk 2/3
  Dates: 4 days
  Date Range: 2026-01-17 to 2026-01-14
============================================================

2025-12-29 07:54:35 | INFO     | ======================================================================
2025-12-29 07:54:35 | INFO     | Load Factor Scraper Started - Route: ATZ-RUH
2025-12-29 07:54:35 | INFO     | Log file: D:\CODERED\LAB\market_insights\outputs\run_generated_291225_at_07.54\logs\LF_ATZ-RUH_20251229_075435.log
2025-12-29 07:54:35 | INFO     | Enhanced logging: Capturing both logging.info() and print()
2025-12-29 07:54:35 | INFO     | ======================================================================
[LF] Processing dates (override): ['17JAN', '16JAN', '15JAN', '14JAN']
[LF] Attaching to Chrome for Altea access
[LF][[OK] SUCCESS] Connected to Chrome on 127.0.0.1:9233 (after 1 attempts)
[LF][[OK] SUCCESS] Found Amadeus Altea window: Altéa Reservation Desktop
[LF][[INFO] INFO] URL: https://tc212.resdesktop.altea.amadeus.com/app_ard/apf/init/login?SITE=ESMPESMP&LANGUAGE=GB&MARKETS=ARDW_PROD_WBP&ACTION=clpLogin
[LF] Processing ATZ-RUH for 17JAN
[LF][ERROR] Amadeus command error detected: UNKNOWN TRANSACTION
[LF][ERROR] Command: SN17JANATZRUH/ASM
[LF][RESYNC] Triggering immediate resync to last successful SN command
============================================================
[LF][RESYNC] Command 'SN17JANATZRUH/ASM' failed: TECH_ERROR:UNKNOWN TRANSACTION
[LF][RESYNC] Re-running entire day from SN command for ATZ-RUH 17JAN
[LF][RESYNC] Attempt 1/50 (waiting 1.0s before retry...)
============================================================
[LF][RESYNC] Sending IG to clear session state...
[LF][RESYNC] Session cleared with IG
[LF] Processing ATZ-RUH for 17JAN
[LF] No direct flights on 17JAN for ATZ-RUH
[LF] Processing ATZ-RUH for 16JAN
[LF] No direct flights on 16JAN for ATZ-RUH
[LF] Processing ATZ-RUH for 15JAN
[LF] No direct flights on 15JAN for ATZ-RUH
[LF] Processing ATZ-RUH for 14JAN
[LF] 14JAN: found 1 direct flights
[LF] SM465 14JAN: BKG=84, GRP=0, CAP=179, LF%=46.9%, Brd-Off=ATZ-RUH, Classes: I:1, O:9, U:17, X:15, T:9, W:7, S:9, G:9, L:8
[LF] Getting WEEKLY/LASTSOLD data for 1 flights
[LF] SM465 14JAN: LASTSOLD=2025-12-28 00:00:00, WEEKLY=18, TODAY=0, YDAY=7
[LF] Results summary:
  2026-01-17: 0 flights
  2026-01-16: 0 flights
  2026-01-15: 0 flights
  2026-01-14: 1 flights

============================================================
[Worker_9233] ✓ COMPLETED: ATZ-RUH
  Results: 4 dates
  Errors: 0 dates
  Total Processed: 1 groups
============================================================


============================================================
[Worker_9233] Processing: JED-ATZ
  Tier 0: Range 2, Chunk 3/3
  Dates: 3 days
  Date Range: 2026-01-13 to 2026-01-11
============================================================

2025-12-29 07:54:53 | INFO     | ======================================================================
2025-12-29 07:54:53 | INFO     | Load Factor Scraper Started - Route: JED-ATZ
2025-12-29 07:54:53 | INFO     | Log file: D:\CODERED\LAB\market_insights\outputs\run_generated_291225_at_07.54\logs\LF_JED-ATZ_20251229_075453.log
2025-12-29 07:54:53 | INFO     | Enhanced logging: Capturing both logging.info() and print()
2025-12-29 07:54:53 | INFO     | ======================================================================
[LF] Processing dates (override): ['13JAN', '12JAN', '11JAN']
[LF] Attaching to Chrome for Altea access
2025-12-29 07:54:53 | INFO     | Starting LF search for route: JED-ATZ
2025-12-29 07:54:53 | INFO     | [START] LF Search
[LF][[OK] SUCCESS] Connected to Chrome on 127.0.0.1:9233 (after 1 attempts)
2025-12-29 07:54:54 | INFO     | [HEALTH CHECK] [OK] Chrome connection is healthy
[LF][[OK] SUCCESS] Found Amadeus Altea window: Altéa Reservation Desktop
[LF][[INFO] INFO] URL: https://tc212.resdesktop.altea.amadeus.com/app_ard/apf/init/login?SITE=ESMPESMP&LANGUAGE=GB&MARKETS=ARDW_PROD_WBP&ACTION=clpLogin
2025-12-29 07:54:54 | INFO     | [DAY_START] Processing 13JAN
[LF] Processing JED-ATZ for 13JAN
2025-12-29 07:54:54 | INFO     | [lf.day.start] Processing JED-ATZ for 13JAN
[LF] 13JAN: found 2 direct flights
2025-12-29 07:54:55 | INFO     | [lf.day.flights_found] Found 2 flights on 13JAN
2025-12-29 07:55:00 | INFO     | [lf.flight.extracted] SM454 on 13JAN: BKG=165, LF=98.8%
[LF] SM454 13JAN: BKG=165, GRP=160, CAP=167, LF%=98.8%, Brd-Off=JED-ATZ, Classes: P:160, I:2, W:2, S:1
2025-12-29 07:55:03 | INFO     | [lf.flight.extracted] SM456 on 13JAN: BKG=146, LF=87.4%
[LF] SM456 13JAN: BKG=146, GRP=135, CAP=167, LF%=87.4%, Brd-Off=JED-ATZ, Classes: P:91, E:45, I:4, O:2, U:3, G:1
[LF] Getting WEEKLY/LASTSOLD data for 2 flights
[LF] SM454 13JAN: LASTSOLD=2025-12-28 00:00:00, WEEKLY=38, TODAY=0, YDAY=38
[LF] SM456 13JAN: LASTSOLD=2025-12-28 00:00:00, WEEKLY=47, TODAY=0, YDAY=47
2025-12-29 07:55:13 | INFO     | [SUCCESS] Day 13JAN
2025-12-29 07:55:13 | INFO     | [DAY_START] Processing 12JAN
[LF] Processing JED-ATZ for 12JAN
2025-12-29 07:55:13 | INFO     | [lf.day.start] Processing JED-ATZ for 12JAN
[LF] 12JAN: found 3 direct flights
2025-12-29 07:55:14 | INFO     | [lf.day.flights_found] Found 3 flights on 12JAN
2025-12-29 07:55:16 | INFO     | [lf.flight.extracted] SM456 on 12JAN: BKG=138, LF=82.6%
[LF] SM456 12JAN: BKG=138, GRP=129, CAP=167, LF%=82.6%, Brd-Off=JED-ATZ, Classes: P:129, I:4, O:2, U:3
2025-12-29 07:55:20 | INFO     | [lf.flight.extracted] SM492 on 12JAN: BKG=112, LF=67.1%
[LF] SM492 12JAN: BKG=112, GRP=94, CAP=167, LF%=67.1%, Brd-Off=JED-ATZ, Classes: P:45, E:49, I:4, O:2, U:3, X:1, W:8
2025-12-29 07:55:24 | INFO     | [lf.flight.extracted] SM454 on 12JAN: BKG=144, LF=86.2%
[LF] SM454 12JAN: BKG=144, GRP=135, CAP=167, LF%=86.2%, Brd-Off=JED-ATZ, Classes: P:94, E:41, I:4, O:2, U:3
[LF] Getting WEEKLY/LASTSOLD data for 3 flights
[LF] SM456 12JAN: LASTSOLD=2025-12-16 00:00:00, WEEKLY=0, TODAY=0, YDAY=0
2025-12-29 07:55:30 | ERROR    | Atomic write failed for D:\CODERED\LAB\market_insights\outputs\run_generated_291225_at_07.54\checkpoints\flight_booking_data.json: [WinError 2] The system cannot find the file specified: 'D:\\CODERED\\LAB\\market_insights\\outputs\\run_generated_291225_at_07.54\\checkpoints\\flight_booking_data.json'
[LF] SM492 12JAN: LASTSOLD=2025-12-24 00:00:00, WEEKLY=8, TODAY=0, YDAY=0
[LF] SM454 12JAN: LASTSOLD=2025-12-25 00:00:00, WEEKLY=5, TODAY=0, YDAY=0
2025-12-29 07:55:39 | INFO     | [SUCCESS] Day 12JAN
2025-12-29 07:55:39 | INFO     | [DAY_START] Processing 11JAN
[LF] Processing JED-ATZ for 11JAN
2025-12-29 07:55:39 | INFO     | [lf.day.start] Processing JED-ATZ for 11JAN
[LF] 11JAN: found 2 direct flights
2025-12-29 07:55:40 | INFO     | [lf.day.flights_found] Found 2 flights on 11JAN
2025-12-29 07:55:42 | INFO     | [lf.flight.extracted] SM492 on 11JAN: BKG=179, LF=107.2%
[LF] SM492 11JAN: BKG=179, GRP=179, CAP=167, LF%=107.2%, Brd-Off=JED-ATZ, Classes: P:179
2025-12-29 07:55:46 | INFO     | [lf.flight.extracted] SM456 on 11JAN: BKG=156, LF=87.6%
[LF] SM456 11JAN: BKG=156, GRP=141, CAP=178, LF%=87.6%, Brd-Off=JED-ATZ, Classes: P:141, I:4, O:2, U:3, X:1, V:4, K:1
[LF] Getting WEEKLY/LASTSOLD data for 2 flights
[LF] SM492 11JAN: LASTSOLD=2025-11-23 00:00:00, WEEKLY=0, TODAY=0, YDAY=0
[LF] SM456 11JAN: LASTSOLD=2025-12-24 00:00:00, WEEKLY=2, TODAY=0, YDAY=0
2025-12-29 07:55:57 | INFO     | [SUCCESS] Day 11JAN
[LF] Results summary:
  2026-01-13: 2 flights
  2026-01-12: 3 flights
  2026-01-11: 2 flights
2025-12-29 07:55:57 | INFO     | [SUCCESS] LF Search Complete

============================================================
[Worker_9233] ✓ COMPLETED: JED-ATZ
  Results: 3 dates
  Errors: 0 dates
  Total Processed: 2 groups
============================================================

2025-12-29 07:55:59 | INFO     | [Worker_9233] Completed: JED-ATZ - 3 results, 0 errors

============================================================
[Worker_9233] Processing: JED-ATZ
  Tier 0: Range 1, Chunk 2/3
  Dates: 5 days
  Date Range: 2026-01-05 to 2026-01-01
============================================================

2025-12-29 07:55:59 | INFO     | [Worker_9233] Processing: JED-ATZ
2025-12-29 07:55:59 | INFO     |   Tier 0: Range 1, Chunk 2/3 (5 days)
2025-12-29 07:55:59 | INFO     | ======================================================================
2025-12-29 07:55:59 | INFO     | Load Factor Scraper Started - Route: JED-ATZ
2025-12-29 07:55:59 | INFO     | Log file: D:\CODERED\LAB\market_insights\outputs\run_generated_291225_at_07.54\logs\LF_JED-ATZ_20251229_075559.log
2025-12-29 07:55:59 | INFO     | Enhanced logging: Capturing both logging.info() and print()
2025-12-29 07:55:59 | INFO     | ======================================================================
[LF] Processing dates (override): ['05JAN', '04JAN', '03JAN', '02JAN', '01JAN']
[LF] Attaching to Chrome for Altea access
2025-12-29 07:55:59 | INFO     | Starting LF search for route: JED-ATZ
2025-12-29 07:55:59 | INFO     | [START] LF Search
[LF][[OK] SUCCESS] Connected to Chrome on 127.0.0.1:9233 (after 1 attempts)
2025-12-29 07:56:01 | INFO     | [HEALTH CHECK] [OK] Chrome connection is healthy
[LF][[OK] SUCCESS] Found Amadeus Altea window: Altéa Reservation Desktop
[LF][[INFO] INFO] URL: https://tc212.resdesktop.altea.amadeus.com/app_ard/apf/init/login?SITE=ESMPESMP&LANGUAGE=GB&MARKETS=ARDW_PROD_WBP&ACTION=clpLogin
2025-12-29 07:56:01 | INFO     | [DAY_START] Processing 05JAN
[LF] Processing JED-ATZ for 05JAN
2025-12-29 07:56:01 | INFO     | [lf.day.start] Processing JED-ATZ for 05JAN
[LF] 05JAN: found 4 direct flights
2025-12-29 07:56:02 | INFO     | [lf.day.flights_found] Found 4 flights on 05JAN
2025-12-29 07:56:04 | INFO     | [lf.flight.extracted] SM492 on 05JAN: BKG=93, LF=55.7%
[LF] SM492 05JAN: BKG=93, GRP=71, CAP=167, LF%=55.7%, Brd-Off=JED-ATZ, Classes: P:69, E:2, I:4, O:2, U:3, X:1, T:1, W:9, S:1, K:1
2025-12-29 07:56:07 | INFO     | [lf.flight.extracted] SM456 on 05JAN: BKG=123, LF=73.7%
[LF] SM456 05JAN: BKG=123, GRP=92, CAP=167, LF%=73.7%, Brd-Off=JED-ATZ, Classes: P:48, E:45, I:4, O:2, U:3, X:7, T:3, W:9, S:1, G:1
2025-12-29 07:56:11 | INFO     | [lf.flight.extracted] SM422 on 05JAN: BKG=171, LF=102.4%
[LF] SM422 05JAN: BKG=171, GRP=159, CAP=167, LF%=102.4%, Brd-Off=JED-ATZ, Classes: P:112, E:47, I:4, O:2, U:3, X:2, S:1
2025-12-29 07:56:14 | INFO     | [lf.flight.extracted] SM454 on 05JAN: BKG=167, LF=100.0%
[LF] SM454 05JAN: BKG=167, GRP=152, CAP=167, LF%=100.0%, Brd-Off=JED-ATZ, Classes: P:63, E:89, I:8, O:1, X:5, W:1
[LF] Getting WEEKLY/LASTSOLD data for 4 flights
[LF] SM492 05JAN: LASTSOLD=2025-12-28 00:00:00, WEEKLY=11, TODAY=0, YDAY=2
[LF] SM456 05JAN: LASTSOLD=2025-12-28 00:00:00, WEEKLY=5, TODAY=0, YDAY=2
[LF] SM422 05JAN: LASTSOLD=2025-12-17 00:00:00, WEEKLY=0, TODAY=0, YDAY=0
[LF] SM454 05JAN: LASTSOLD=2025-12-14 00:00:00, WEEKLY=0, TODAY=0, YDAY=0
2025-12-29 07:56:34 | INFO     | [SUCCESS] Day 05JAN
2025-12-29 07:56:34 | INFO     | [DAY_START] Processing 04JAN
[LF] Processing JED-ATZ for 04JAN
2025-12-29 07:56:34 | INFO     | [lf.day.start] Processing JED-ATZ for 04JAN
[LF] 04JAN: found 2 direct flights
2025-12-29 07:56:35 | INFO     | [lf.day.flights_found] Found 2 flights on 04JAN
2025-12-29 07:56:37 | INFO     | [lf.flight.extracted] SM492 on 04JAN: BKG=175, LF=104.8%
[LF] SM492 04JAN: BKG=175, GRP=175, CAP=167, LF%=104.8%, Brd-Off=JED-ATZ, Classes: P:175
2025-12-29 07:56:40 | INFO     | [lf.flight.extracted] SM456 on 04JAN: BKG=134, LF=80.2%
[LF] SM456 04JAN: BKG=134, GRP=92, CAP=167, LF%=80.2%, Brd-Off=JED-ATZ, Classes: P:92, I:4, O:2, U:6, X:4, T:13, W:9, S:3, K:1
[LF] Getting WEEKLY/LASTSOLD data for 2 flights
[LF] SM492 04JAN: LASTSOLD=2025-12-20 00:00:00, WEEKLY=0, TODAY=0, YDAY=0
Process Process-9:
Traceback (most recent call last):
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\process.py", line 313, in _bootstrap
    self.run()
    ~~~~~~~~^^
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\CODERED\LAB\market_insights\orchestration\queue_worker_system.py", line 580, in lf_worker_process
    results, errors = run_lf_search(
                      ~~~~~~~~~~~~~^
        origin=origin,
        ^^^^^^^^^^^^^^
    ...<3 lines>...
        progress_callback=heartbeat_callback
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "D:\CODERED\LAB\market_insights\lf\orchestration.py", line 771, in run_lf_search
    dtok, rows, err = process_lf_day(drv, origin, dest, dtok, year_for_token)
                      ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\CODERED\LAB\market_insights\lf\orchestration.py", line 287, in process_lf_day
    return handle_amadeus_error_with_resync(
        drv, origin, dest, dtok, year,
        _process_lf_day_once,
        resync_wait_sec=RESYNC_WAIT_SEC
    )
  File "D:\CODERED\LAB\market_insights\lf\amadeus.py", line 186, in handle_amadeus_error_with_resync
    result = process_func(drv, origin, dest, dtok, year)
  File "D:\CODERED\LAB\market_insights\lf\orchestration.py", line 483, in _process_lf_day_once
    last_sold, weekly_sold, sold_today, sold_yesterday = weekly_from_lpl_pages(drv, flight, dtok, year_)
                                                         ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\CODERED\LAB\market_insights\lf\parsers.py", line 868, in weekly_from_lpl_pages
    first = send_and_wait(drv, cmd, expect_tokens=[flight, dtok], timeout=SEND_TIMEOUT_SEC) or ""
            ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\CODERED\LAB\market_insights\lf\amadeus.py", line 370, in send_and_wait
    inp = focus_cmdline(drv)
  File "D:\CODERED\LAB\market_insights\lf\amadeus.py", line 263, in focus_cmdline
    time.sleep(0.15)
    ~~~~~~~~~~^^^^^^
KeyboardInterrupt
Exception ignored in: <function Service.__del__ at 0x0000016223808F40>
Traceback (most recent call last):
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\site-packages\selenium\webdriver\common\service.py", line 185, in __del__
    self.stop()
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\site-packages\selenium\webdriver\common\service.py", line 146, in stop
    self.send_remote_shutdown_command()
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\site-packages\selenium\webdriver\common\service.py", line 126, in send_remote_shutdown_command
    request.urlopen(f"{self.service_url}/shutdown")
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\urllib\request.py", line 189, in urlopen
    return opener.open(url, data, timeout)
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\urllib\request.py", line 489, in open
    response = self._open(req, data)
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\urllib\request.py", line 506, in _open
    result = self._call_chain(self.handle_open, protocol, protocol +
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\urllib\request.py", line 466, in _call_chain
    result = func(*args)
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\urllib\request.py", line 1348, in http_open
    return self.do_open(http.client.HTTPConnection, req)
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\urllib\request.py", line 1319, in do_open
    h.request(req.get_method(), req.selector, req.data, headers,
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1338, in request
    self._send_request(method, url, body, headers, encode_chunked)
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1384, in _send_request
    self.endheaders(body, encode_chunked=encode_chunked)
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1003, in connect
    self.sock = self._create_connection(
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\socket.py", line 856, in create_connection
    exceptions.clear()  # raise only the last error
KeyboardInterrupt: 
Exception ignored in atexit callback <bound method BufferedTraceWriter.shutdown of <market_insights.observability.tracing.tracer.BufferedTraceWriter object at 0x00000162238C7B60>>:
Traceback (most recent call last):
  File "D:\CODERED\LAB\market_insights\observability\tracing\tracer.py", line 322, in shutdown
    self._writer_thread.join(timeout=5.0)
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\threading.py", line 1094, in join
    self._handle.join(timeout)
KeyboardInterrupt: 
