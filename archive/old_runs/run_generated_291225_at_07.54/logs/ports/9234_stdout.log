
============================================================
     LF WORKER - PORT 9234
============================================================
Worker: Worker_9234
Status: READY
Waiting for tasks...
============================================================


============================================================
[Worker_9234] Processing: JED-CAI
  Tier 0: Range 2, Chunk 3/3
  Dates: 3 days
  Date Range: 2026-01-13 to 2026-01-11
============================================================

2025-12-29 07:54:35 | INFO     | ======================================================================
2025-12-29 07:54:35 | INFO     | Load Factor Scraper Started - Route: JED-CAI
2025-12-29 07:54:35 | INFO     | Log file: D:\CODERED\LAB\market_insights\outputs\run_generated_291225_at_07.54\logs\LF_JED-CAI_20251229_075435.log
2025-12-29 07:54:35 | INFO     | Enhanced logging: Capturing both logging.info() and print()
2025-12-29 07:54:35 | INFO     | ======================================================================
[LF] Processing dates (override): ['13JAN', '12JAN', '11JAN']
[LF] Attaching to Chrome for Altea access
[LF][[OK] SUCCESS] Connected to Chrome on 127.0.0.1:9234 (after 1 attempts)
[LF][[OK] SUCCESS] Found Amadeus Altea window: Altéa Reservation Desktop
[LF][[INFO] INFO] URL: https://tc212.resdesktop.altea.amadeus.com/app_ard/apf/init/login?SITE=ESMPESMP&LANGUAGE=GB&MARKETS=ARDW_PROD_WBP&ACTION=clpLogin
[LF] Processing JED-CAI for 13JAN
[LF][ERROR] Amadeus command error detected: UNKNOWN TRANSACTION
[LF][ERROR] Command: SN13JANJEDCAI/ASM
[LF][RESYNC] Triggering immediate resync to last successful SN command
============================================================
[LF][RESYNC] Command 'SN13JANJEDCAI/ASM' failed: TECH_ERROR:UNKNOWN TRANSACTION
[LF][RESYNC] Re-running entire day from SN command for JED-CAI 13JAN
[LF][RESYNC] Attempt 1/50 (waiting 1.0s before retry...)
============================================================
[LF][RESYNC] Sending IG to clear session state...
[LF][RESYNC] Session cleared with IG
[LF] Processing JED-CAI for 13JAN
[LF] 13JAN: found 6 direct flights
[LF] SM472 13JAN: BKG=53, GRP=50, CAP=167, LF%=31.7%, Brd-Off=JED-CAI, Classes: P:50, U:3
[LF] SM480 13JAN: BKG=112, GRP=90, CAP=167, LF%=67.1%, Brd-Off=JED-CAI, Classes: P:45, E:45, U:10, X:11, K:1
[LF] SM478 13JAN: BKG=142, GRP=131, CAP=167, LF%=85.0%, Brd-Off=JED-CAI, Classes: P:131, U:10, K:1
[LF] SM460 13JAN: BKG=113, GRP=93, CAP=175, LF%=64.6%, Brd-Off=JED-CAI, Classes: N:2, P:92, E:1, U:8, X:8, S:2
[LF] SM424 13JAN: BKG=51, GRP=46, CAP=167, LF%=30.5%, Brd-Off=JED-CAI, Classes: P:46, I:2, U:3
[LF] SM476 13JAN: BKG=85, GRP=80, CAP=167, LF%=50.9%, Brd-Off=JED-CAI, Classes: P:80, U:1, X:3, K:1
[LF] Getting WEEKLY/LASTSOLD data for 6 flights
[LF] SM472 13JAN: LASTSOLD=2025-12-22 00:00:00, WEEKLY=1, TODAY=0, YDAY=0
[LF] SM480 13JAN: LASTSOLD=2025-12-28 00:00:00, WEEKLY=21, TODAY=0, YDAY=7
[LF] SM478 13JAN: LASTSOLD=2025-12-28 00:00:00, WEEKLY=3, TODAY=0, YDAY=1
[LF] SM460 13JAN: LASTSOLD=2025-12-29 00:00:00, WEEKLY=13, TODAY=2, YDAY=11
[LF] SM424 13JAN: LASTSOLD=2025-12-15 00:00:00, WEEKLY=0, TODAY=0, YDAY=0
[LF] SM476 13JAN: LASTSOLD=2025-12-28 00:00:00, WEEKLY=4, TODAY=0, YDAY=4
[LF] Processing JED-CAI for 12JAN
[LF] 12JAN: found 4 direct flights
[LF] SM480 12JAN: BKG=139, GRP=131, CAP=175, LF%=79.4%, Brd-Off=JED-CAI, Classes: P:131, U:7, W:1
[LF] SM476 12JAN: BKG=126, GRP=117, CAP=167, LF%=75.4%, Brd-Off=JED-CAI, Classes: P:117, U:4, X:3, G:1, K:1
[LF] SM478 12JAN: BKG=143, GRP=130, CAP=167, LF%=85.6%, Brd-Off=JED-CAI, Classes: P:130, U:10, X:1, S:1, K:1
[LPC] SM478 12JAN: Found 0 outbound flights with connecting passengers
[LF] SM460 12JAN: BKG=126, GRP=114, CAP=167, LF%=75.4%, Brd-Off=JED-CAI, Classes: P:114, U:8, X:2, G:1, L:1
[LPC] SM460 12JAN: Found 0 outbound flights with connecting passengers
[LF] Getting WEEKLY/LASTSOLD data for 4 flights
[LF] SM480 12JAN: LASTSOLD=2025-12-24 00:00:00, WEEKLY=1, TODAY=0, YDAY=0
[LF] SM476 12JAN: LASTSOLD=2025-12-28 00:00:00, WEEKLY=5, TODAY=0, YDAY=3
[LF] SM478 12JAN: LASTSOLD=2025-12-28 00:00:00, WEEKLY=9, TODAY=0, YDAY=1
[LF] SM460 12JAN: LASTSOLD=2025-12-28 00:00:00, WEEKLY=9, TODAY=0, YDAY=4
[LF] Processing JED-CAI for 11JAN
[LF] 11JAN: found 5 direct flights
[LF] SM424 11JAN: BKG=143, GRP=127, CAP=178, LF%=80.3%, Brd-Off=JED-CAI, Classes: N:1, P:64, E:62, U:10, V:6
[LPC] SM424 11JAN: Found 1 outbound flights with connecting passengers
[LF] SM476 11JAN: BKG=97, GRP=66, CAP=167, LF%=58.1%, Brd-Off=JED-CAI, Classes: P:66, U:10, X:15, S:6
[LF] SM432 11JAN: BKG=163, GRP=140, CAP=167, LF%=97.6%, Brd-Off=JED-CAI, Classes: P:140, O:7, U:5, X:11
[LF] SM460 11JAN: BKG=126, GRP=94, CAP=167, LF%=75.4%, Brd-Off=JED-CAI, Classes: P:94, I:7, O:7, U:7, X:7, T:4
[LF] SM478 11JAN: BKG=165, GRP=137, CAP=175, LF%=94.3%, Brd-Off=JED-CAI, Classes: P:43, E:94, U:10, X:14, S:4
[LF] Getting WEEKLY/LASTSOLD data for 5 flights
[LF] SM424 11JAN: LASTSOLD=2025-12-19 00:00:00, WEEKLY=0, TODAY=0, YDAY=0
[LF] SM476 11JAN: LASTSOLD=2025-12-28 00:00:00, WEEKLY=22, TODAY=0, YDAY=16
[LF] SM432 11JAN: LASTSOLD=2025-12-28 00:00:00, WEEKLY=14, TODAY=0, YDAY=10
[LF] SM460 11JAN: LASTSOLD=2025-12-29 00:00:00, WEEKLY=8, TODAY=4, YDAY=2
[LF] SM478 11JAN: LASTSOLD=2025-12-29 00:00:00, WEEKLY=6, TODAY=2, YDAY=4
[LF] Results summary:
  2026-01-13: 6 flights
  2026-01-12: 4 flights
  2026-01-11: 5 flights

============================================================
[Worker_9234] ✓ COMPLETED: JED-CAI
  Results: 3 dates
  Errors: 0 dates
  Total Processed: 1 groups
============================================================


============================================================
[Worker_9234] Processing: ATZ-RUH
  Tier 0: Range 1, Chunk 3/3
  Dates: 4 days
  Date Range: 2025-12-31 to 2025-12-28
============================================================

2025-12-29 07:56:45 | INFO     | ======================================================================
2025-12-29 07:56:45 | INFO     | Load Factor Scraper Started - Route: ATZ-RUH
2025-12-29 07:56:45 | INFO     | Log file: D:\CODERED\LAB\market_insights\outputs\run_generated_291225_at_07.54\logs\LF_ATZ-RUH_20251229_075645.log
2025-12-29 07:56:45 | INFO     | Enhanced logging: Capturing both logging.info() and print()
2025-12-29 07:56:45 | INFO     | ======================================================================
[LF] Processing dates (override): ['31DEC', '30DEC', '29DEC', '28DEC']
[LF] Attaching to Chrome for Altea access
2025-12-29 07:56:45 | INFO     | Starting LF search for route: ATZ-RUH
2025-12-29 07:56:45 | INFO     | [START] LF Search
[LF][[OK] SUCCESS] Connected to Chrome on 127.0.0.1:9234 (after 1 attempts)
2025-12-29 07:56:46 | INFO     | [HEALTH CHECK] [OK] Chrome connection is healthy
[LF][[OK] SUCCESS] Found Amadeus Altea window: Altéa Reservation Desktop
[LF][[INFO] INFO] URL: https://tc212.resdesktop.altea.amadeus.com/app_ard/apf/init/login?SITE=ESMPESMP&LANGUAGE=GB&MARKETS=ARDW_PROD_WBP&ACTION=clpLogin
2025-12-29 07:56:46 | INFO     | [DAY_START] Processing 31DEC
[LF] Processing ATZ-RUH for 31DEC
2025-12-29 07:56:46 | INFO     | [lf.day.start] Processing ATZ-RUH for 31DEC
[LF] 31DEC: found 1 direct flights
2025-12-29 07:56:47 | INFO     | [lf.day.flights_found] Found 1 flights on 31DEC
Process Process-10:
Traceback (most recent call last):
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\process.py", line 313, in _bootstrap
    self.run()
    ~~~~~~~~^^
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\CODERED\LAB\market_insights\orchestration\queue_worker_system.py", line 580, in lf_worker_process
    results, errors = run_lf_search(
                      ~~~~~~~~~~~~~^
        origin=origin,
        ^^^^^^^^^^^^^^
    ...<3 lines>...
        progress_callback=heartbeat_callback
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "D:\CODERED\LAB\market_insights\lf\orchestration.py", line 771, in run_lf_search
    dtok, rows, err = process_lf_day(drv, origin, dest, dtok, year_for_token)
                      ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\CODERED\LAB\market_insights\lf\orchestration.py", line 287, in process_lf_day
    return handle_amadeus_error_with_resync(
        drv, origin, dest, dtok, year,
        _process_lf_day_once,
        resync_wait_sec=RESYNC_WAIT_SEC
    )
  File "D:\CODERED\LAB\market_insights\lf\amadeus.py", line 186, in handle_amadeus_error_with_resync
    result = process_func(drv, origin, dest, dtok, year)
  File "D:\CODERED\LAB\market_insights\lf\orchestration.py", line 360, in _process_lf_day_once
    ll_data, ll_txt = parse_ll_i_with_classes(drv, flight, dtok)
                      ~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "D:\CODERED\LAB\market_insights\lf\parsers.py", line 435, in parse_ll_i_with_classes
    ll_txt = send_and_wait(drv, ll_cmd, ["BOOKINGS FOR", flight], timeout=SEND_TIMEOUT_SEC) or ""
             ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\CODERED\LAB\market_insights\lf\amadeus.py", line 370, in send_and_wait
    inp = focus_cmdline(drv)
  File "D:\CODERED\LAB\market_insights\lf\amadeus.py", line 259, in focus_cmdline
    time.sleep(0.15)
    ~~~~~~~~~~^^^^^^
KeyboardInterrupt
Exception ignored in: <function Service.__del__ at 0x00000134790F8F40>
Traceback (most recent call last):
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\site-packages\selenium\webdriver\common\service.py", line 185, in __del__
    self.stop()
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\site-packages\selenium\webdriver\common\service.py", line 146, in stop
    self.send_remote_shutdown_command()
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\site-packages\selenium\webdriver\common\service.py", line 126, in send_remote_shutdown_command
    request.urlopen(f"{self.service_url}/shutdown")
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\urllib\request.py", line 189, in urlopen
    return opener.open(url, data, timeout)
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\urllib\request.py", line 489, in open
    response = self._open(req, data)
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\urllib\request.py", line 506, in _open
    result = self._call_chain(self.handle_open, protocol, protocol +
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\urllib\request.py", line 466, in _call_chain
    result = func(*args)
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\urllib\request.py", line 1348, in http_open
    return self.do_open(http.client.HTTPConnection, req)
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\urllib\request.py", line 1319, in do_open
    h.request(req.get_method(), req.selector, req.data, headers,
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1338, in request
    self._send_request(method, url, body, headers, encode_chunked)
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1384, in _send_request
    self.endheaders(body, encode_chunked=encode_chunked)
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1333, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1093, in _send_output
    self.send(msg)
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1037, in send
    self.connect()
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\http\client.py", line 1003, in connect
    self.sock = self._create_connection(
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\socket.py", line 856, in create_connection
    exceptions.clear()  # raise only the last error
KeyboardInterrupt: 
Exception ignored in atexit callback <bound method BufferedTraceWriter.shutdown of <market_insights.observability.tracing.tracer.BufferedTraceWriter object at 0x00000134791B7B60>>:
Traceback (most recent call last):
  File "D:\CODERED\LAB\market_insights\observability\tracing\tracer.py", line 322, in shutdown
    self._writer_thread.join(timeout=5.0)
  File "C:\Users\MANDO\AppData\Local\Programs\Python\Python313\Lib\threading.py", line 1094, in join
    self._handle.join(timeout)
KeyboardInterrupt: 
